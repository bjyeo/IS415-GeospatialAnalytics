<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Bao Jie Yeo">
<meta name="dcterms.date" content="2024-11-22">

<title>IS415 Geospatial Analytics - Take Home Exercise 3 (Corrected)</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">IS415 Geospatial Analytics</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Hands-on Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/Ex01/Ex01.html">
 <span class="dropdown-text">Hands-on Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/Ex02/Ex02.html">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/Ex03/Ex03.html">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/ICE04/ICE04.html">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/Ex05/Ex05.html">
 <span class="dropdown-text">Hands-on Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/Ex06/Ex06.html">
 <span class="dropdown-text">Hands-on Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/Ex08/Ex08.html">
 <span class="dropdown-text">Hands-on Exercise 8</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/Ex08/Ex08.html">
 <span class="dropdown-text">Hands-on Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/Ex10/Ex10.html">
 <span class="dropdown-text">Hands-on Exercise 10</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/Ex10/Ex10.html">
 <span class="dropdown-text">Hands-on Exercise 11</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../HandsOnEx/Ex12/Ex12.html">
 <span class="dropdown-text">Hands-on Exercise 12</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">In Class Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../../InClassEx/ICE01/ICE01.html">
 <span class="dropdown-text">In Class Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/ICE02/ICE02.html">
 <span class="dropdown-text">In Class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/ICE03/ICE03.html">
 <span class="dropdown-text">In Class Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/ICE04/ICE04.html">
 <span class="dropdown-text">In Class Exercise 4</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/ICE05/ICE05.html">
 <span class="dropdown-text">In Class Exercise 5</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/ICE06/ICE06.html">
 <span class="dropdown-text">In Class Exercise 6</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/ICE09/ICE09.html">
 <span class="dropdown-text">In Class Exercise 9</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/ICE10/ICE10.html">
 <span class="dropdown-text">In Class Exercise 10</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/ICE11/ICE11.html">
 <span class="dropdown-text">In Class Exercise 11</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../InClassEx/ICE12/ICE12.html">
 <span class="dropdown-text">In Class Exercise 12</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Take Home Exercise</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../../TakehomeEx/THE01/THE01.html">
 <span class="dropdown-text">Take Home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../TakehomeEx/THE02/THE02.html">
 <span class="dropdown-text">Take Home Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../TakehomeEx/THE03/THE03.html">
 <span class="dropdown-text">Take Home Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../TakehomeEx/THE03C/THE03C.html">
 <span class="dropdown-text">Take Home Exercise 3 (Corrected)</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Outline</h2>
   
  <ul>
  <li><a href="#spatial-distribution-analysis-of-educational-facilities-in-jakarta" id="toc-spatial-distribution-analysis-of-educational-facilities-in-jakarta" class="nav-link active" data-scroll-target="#spatial-distribution-analysis-of-educational-facilities-in-jakarta">1.0 Spatial Distribution Analysis of Educational Facilities in Jakarta</a>
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">1.1 Overview</a></li>
  <li><a href="#scope-and-objectives" id="toc-scope-and-objectives" class="nav-link" data-scroll-target="#scope-and-objectives">1.2 Scope and Objectives</a></li>
  <li><a href="#indonesias-education-system" id="toc-indonesias-education-system" class="nav-link" data-scroll-target="#indonesias-education-system">1.3 Indonesia’s Education System</a></li>
  <li><a href="#analysis-methodology" id="toc-analysis-methodology" class="nav-link" data-scroll-target="#analysis-methodology">1.4 Analysis Methodology</a></li>
  <li><a href="#datasets" id="toc-datasets" class="nav-link" data-scroll-target="#datasets">1.4 Datasets</a></li>
  </ul></li>
  <li><a href="#data-preprocessing" id="toc-data-preprocessing" class="nav-link" data-scroll-target="#data-preprocessing">2.0 Data Preprocessing</a></li>
  <li><a href="#exploratory-data-analysis-provincial-level" id="toc-exploratory-data-analysis-provincial-level" class="nav-link" data-scroll-target="#exploratory-data-analysis-provincial-level">3.0 Exploratory Data Analysis (Provincial Level)</a>
  <ul class="collapse">
  <li><a href="#overall-distribution-patterns" id="toc-overall-distribution-patterns" class="nav-link" data-scroll-target="#overall-distribution-patterns">3.1 Overall Distribution Patterns</a></li>
  <li><a href="#school-level-distribution" id="toc-school-level-distribution" class="nav-link" data-scroll-target="#school-level-distribution">3.2 School Level Distribution</a></li>
  <li><a href="#overall-school-density" id="toc-overall-school-density" class="nav-link" data-scroll-target="#overall-school-density">3.3 Overall School Density</a></li>
  <li><a href="#population-density" id="toc-population-density" class="nav-link" data-scroll-target="#population-density">3.4 Population Density</a></li>
  <li><a href="#overall-summary" id="toc-overall-summary" class="nav-link" data-scroll-target="#overall-summary">3.5 Overall Summary</a></li>
  </ul></li>
  <li><a href="#kernel-density-estimation-provincial-level" id="toc-kernel-density-estimation-provincial-level" class="nav-link" data-scroll-target="#kernel-density-estimation-provincial-level">4.0 Kernel Density Estimation (Provincial Level)</a>
  <ul class="collapse">
  <li><a href="#provincial-kde" id="toc-provincial-kde" class="nav-link" data-scroll-target="#provincial-kde">4.1 Provincial KDE</a></li>
  <li><a href="#kde-by-school-level" id="toc-kde-by-school-level" class="nav-link" data-scroll-target="#kde-by-school-level">4.2 KDE by School Level</a></li>
  <li><a href="#quadrat-analysis" id="toc-quadrat-analysis" class="nav-link" data-scroll-target="#quadrat-analysis">4.3 Quadrat Analysis</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis-city-level" id="toc-exploratory-data-analysis-city-level" class="nav-link" data-scroll-target="#exploratory-data-analysis-city-level">5.0 Exploratory Data Analysis (City Level)</a>
  <ul class="collapse">
  <li><a href="#school-distribution-by-city" id="toc-school-distribution-by-city" class="nav-link" data-scroll-target="#school-distribution-by-city">5.1 School Distribution by City</a></li>
  <li><a href="#public-school-ratio-by-city" id="toc-public-school-ratio-by-city" class="nav-link" data-scroll-target="#public-school-ratio-by-city">5.2 Public School Ratio by City</a></li>
  <li><a href="#nearest-neighbour-analysis" id="toc-nearest-neighbour-analysis" class="nav-link" data-scroll-target="#nearest-neighbour-analysis">5.3 Nearest Neighbour Analysis</a></li>
  <li><a href="#cross-k-function-analysis" id="toc-cross-k-function-analysis" class="nav-link" data-scroll-target="#cross-k-function-analysis">5.4 Cross K Function Analysis</a></li>
  <li><a href="#k-function-and-l-function-analysis" id="toc-k-function-and-l-function-analysis" class="nav-link" data-scroll-target="#k-function-and-l-function-analysis">5.5 K Function and L Function Analysis</a></li>
  </ul></li>
  <li><a href="#kernel-density-estimation-city-level" id="toc-kernel-density-estimation-city-level" class="nav-link" data-scroll-target="#kernel-density-estimation-city-level">6.0 Kernel Density Estimation (City Level)</a>
  <ul class="collapse">
  <li><a href="#kde-analysis" id="toc-kde-analysis" class="nav-link" data-scroll-target="#kde-analysis">6.1 KDE Analysis</a></li>
  <li><a href="#relative-density-metrics" id="toc-relative-density-metrics" class="nav-link" data-scroll-target="#relative-density-metrics">6.2 Relative Density Metrics</a></li>
  </ul></li>
  <li><a href="#insights-and-recommendations" id="toc-insights-and-recommendations" class="nav-link" data-scroll-target="#insights-and-recommendations">7.0 Insights and Recommendations</a>
  <ul class="collapse">
  <li><a href="#key-spatial-patterns" id="toc-key-spatial-patterns" class="nav-link" data-scroll-target="#key-spatial-patterns">7.1 Key Spatial Patterns</a></li>
  <li><a href="#critical-issues" id="toc-critical-issues" class="nav-link" data-scroll-target="#critical-issues">7.2 Critical Issues</a></li>
  <li><a href="#policy-recommendations" id="toc-policy-recommendations" class="nav-link" data-scroll-target="#policy-recommendations">7.3 Policy Recommendations</a></li>
  </ul></li>
  <li><a href="#shiny-application-design" id="toc-shiny-application-design" class="nav-link" data-scroll-target="#shiny-application-design">8.0 Shiny: Application Design</a>
  <ul class="collapse">
  <li><a href="#application-directory" id="toc-application-directory" class="nav-link" data-scroll-target="#application-directory">8.1 Application Directory</a></li>
  <li><a href="#shiny-packages" id="toc-shiny-packages" class="nav-link" data-scroll-target="#shiny-packages">8.2 Shiny Packages</a></li>
  <li><a href="#motivation" id="toc-motivation" class="nav-link" data-scroll-target="#motivation">8.3 Motivation</a></li>
  <li><a href="#iterative-design" id="toc-iterative-design" class="nav-link" data-scroll-target="#iterative-design">8.4 Iterative Design</a></li>
  <li><a href="#application-features" id="toc-application-features" class="nav-link" data-scroll-target="#application-features">8.5 Application Features</a></li>
  </ul></li>
  <li><a href="#shiny-user-interface-design" id="toc-shiny-user-interface-design" class="nav-link" data-scroll-target="#shiny-user-interface-design">9.0 Shiny: User Interface Design</a>
  <ul class="collapse">
  <li><a href="#dashboard-framework-and-layout" id="toc-dashboard-framework-and-layout" class="nav-link" data-scroll-target="#dashboard-framework-and-layout">9.1 Dashboard Framework and Layout</a></li>
  <li><a href="#color-palette" id="toc-color-palette" class="nav-link" data-scroll-target="#color-palette">9.2 Color Palette</a></li>
  <li><a href="#interactivity" id="toc-interactivity" class="nav-link" data-scroll-target="#interactivity">9.3. Interactivity</a></li>
  <li><a href="#shinywidgets-components" id="toc-shinywidgets-components" class="nav-link" data-scroll-target="#shinywidgets-components">9.3.1 <code>shinyWidgets</code> components</a></li>
  <li><a href="#shinybs-tooltips" id="toc-shinybs-tooltips" class="nav-link" data-scroll-target="#shinybs-tooltips">9.3.2 <code>shinyBS</code> tooltips</a></li>
  <li><a href="#visual-container-system" id="toc-visual-container-system" class="nav-link" data-scroll-target="#visual-container-system">9.4 Visual Container System</a></li>
  </ul></li>
  <li><a href="#shiny-storyboarding" id="toc-shiny-storyboarding" class="nav-link" data-scroll-target="#shiny-storyboarding">10.0 Shiny: Storyboarding</a>
  <ul class="collapse">
  <li><a href="#user-personas" id="toc-user-personas" class="nav-link" data-scroll-target="#user-personas">10.1 User Personas</a></li>
  <li><a href="#user-journey-map" id="toc-user-journey-map" class="nav-link" data-scroll-target="#user-journey-map">10.2 User Journey Map</a></li>
  <li><a href="#key-learning-moments" id="toc-key-learning-moments" class="nav-link" data-scroll-target="#key-learning-moments">10.3 Key Learning Moments</a></li>
  <li><a href="#knowledge-building" id="toc-knowledge-building" class="nav-link" data-scroll-target="#knowledge-building">10.4 Knowledge Building</a></li>
  </ul></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references">References</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take Home Exercise 3 (Corrected)</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Bao Jie Yeo </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">November 22, 2024</p>
    </div>
  </div>
  
    <div>
    <div class="quarto-title-meta-heading">Modified</div>
    <div class="quarto-title-meta-contents">
      <p class="date-modified">November 22, 2024</p>
    </div>
  </div>
    
  </div>
  


</header>


<section id="spatial-distribution-analysis-of-educational-facilities-in-jakarta" class="level2">
<h2 class="anchored" data-anchor-id="spatial-distribution-analysis-of-educational-facilities-in-jakarta">1.0 Spatial Distribution Analysis of Educational Facilities in Jakarta</h2>
<section id="overview" class="level3">
<h3 class="anchored" data-anchor-id="overview">1.1 Overview</h3>
<p>Jakarta, the capital of Indonesia, is a bustling metropolis with a diverse population and a complex urban landscape. The city’s educational infrastructure plays a crucial role in shaping the future of its residents. In this analysis, we will explore the spatial distribution of educational facilities across Jakarta to understand the accessibility and equity of educational resources.</p>
</section>
<section id="scope-and-objectives" class="level3">
<h3 class="anchored" data-anchor-id="scope-and-objectives">1.2 Scope and Objectives</h3>
<p>Our project encompasses three primary areas of investigation.</p>
<ol type="1">
<li><strong>Spatial Points Patterns Analysis of Distribution of Schools</strong>:</li>
</ol>
<ul>
<li>Examination of school distribution patterns across Jakarta</li>
<li>Identification of areas with significant clustering or dispersion</li>
<li>Assessment of spatial relationships between different types of educational facilities</li>
</ul>
<ol start="2" type="1">
<li><strong>LISA and Hot-spot, Cold-spot Analysis</strong></li>
</ol>
<ul>
<li>Identification of Local Indicators of Spatial Association (LISA) clusters</li>
<li>Detection of hot-spots and cold-spots of schools</li>
<li>Investigation of spatial autocorrelation in the distribution of schools</li>
</ul>
<ol start="3" type="1">
<li><strong>Geographically Weighted Regression Modeling</strong></li>
</ol>
<ul>
<li>Exploration of relationships between education levels and school availability and accessibility</li>
<li>Assessment of spatial variations across different districts</li>
<li>Investigation of socioeconomic factors influencing school distribution patterns</li>
</ul>
<p>This research aims to provide insights into the spatial dynamics of educational facilities in Jakarta and inform policy decisions to enhance educational equity and access. By combining spatial analysis techniques with statistical modeling, we can uncover hidden patterns and relationships that are crucial for effective urban planning and resource allocation.</p>
</section>
<section id="indonesias-education-system" class="level3">
<h3 class="anchored" data-anchor-id="indonesias-education-system">1.3 Indonesia’s Education System</h3>
<p>Indonesia’s education system is structured into several stages:</p>
<p><strong>Primary Education</strong></p>
<ul>
<li><strong>Elementary School (SD)</strong>: Compulsory education for children aged 7-12 years</li>
<li><strong>Special Elementary School (SDLB)</strong>: Schools for children with special needs</li>
</ul>
<p><strong>Secondary Education</strong></p>
<ul>
<li><strong>Junior High School (SMP)</strong>: Follows elementary school and is for students aged 13-15 years</li>
<li><strong>Special Junior High School (SMPLB)</strong>: Schools for students with special needs</li>
</ul>
<p><strong>High School Education</strong></p>
<ul>
<li><strong>Senior High School (SMA)</strong>: Follows junior high school and is for students aged 16-18 years</li>
<li><strong>Vocational High School (SMK)</strong>: Focuses on vocational training and skills development</li>
<li><strong>Special Senior High School (SMLB)</strong>: Schools for students with special needs</li>
</ul>
<p><strong>Special Education</strong></p>
<ul>
<li><strong>Special Education (SLB)</strong>: Schools for children with disabilities</li>
</ul>
<p>For the purpose of this analysis, we have combined the types of schools into four main types. Note that Junior High Schools may also be interchangeably referred to as Secondary Schools. Senior High Schools may also be referred to as High Schools.</p>
<p>We decided to add SMLB into High Schools instead of Special Education Schools because it is more similar to SMA and SMK in terms of educational level.</p>
<ol type="1">
<li><strong>Elementary Schools</strong>: Includes SD and SDLB</li>
<li><strong>Junior High Schools</strong>: Includes SMP and SMPLB</li>
<li><strong>Senior High Schools</strong>: Includes SMA, SMK, and SMLB</li>
<li><strong>Special Education Schools</strong>: Includes SLB</li>
</ol>
</section>
<section id="analysis-methodology" class="level3">
<h3 class="anchored" data-anchor-id="analysis-methodology">1.4 Analysis Methodology</h3>
<p>The spatial points patterns analysis follows a multi-scale approach:</p>
<ol type="1">
<li><strong>Provincial Level Analysis</strong>:</li>
</ol>
<ul>
<li>Initial exploration of school distribution patterns across Jakarta</li>
<li>Global clustering analysis</li>
<li>Population density correlation</li>
</ul>
<ol start="2" type="1">
<li><strong>City Level Analysis</strong>:</li>
</ol>
<ul>
<li>Local clustering patterns</li>
<li>School type interactions</li>
<li>Public-private school dynamics</li>
</ul>
<ol start="3" type="1">
<li><strong>Statistical Methods</strong>:</li>
</ol>
<ul>
<li>Kernel Density Estimation</li>
<li>Nearest Neighbour Analysis</li>
<li>Quadrat Analysis</li>
<li>Cross-K Function Analysis</li>
<li>Ripley’s K Function and L Function Analysis</li>
</ul>
</section>
<section id="datasets" class="level3">
<h3 class="anchored" data-anchor-id="datasets">1.4 Datasets</h3>
<p>This study utilizes three primary datasets.</p>
<ol type="1">
<li><strong>Indonesia Schools Dataset</strong>:</li>
</ol>
<ul>
<li>Source: Kaggle - <a href="https://www.kaggle.com/datasets/marchotridyo/indonesia-school-dataset-with-province-data">Indonesia Schools Dataset</a></li>
<li>This datasets contains information about schools across Indonesia, including location, type, and educational stage.</li>
</ul>
<ol start="2" type="1">
<li><strong>Indonesia Administrative Boundaries</strong>:</li>
</ol>
<ul>
<li>Source: <a href="https://data.humdata.org/dataset/geoboundaries-admin-boundaries-for-indonesia?">Indonesia - Subnational Administrative Boundaries</a></li>
<li>We selected the ADM2 level boundaries for provincial level analysis.</li>
</ul>
<ol start="3" type="1">
<li><strong>Subdistrict Data</strong>:</li>
</ol>
<ul>
<li>Source: <a href="https://www.indonesia-geospasial.com/2020/04/download-shapefile-shp-batas-desa.html">Indonesia Geospasial</a></li>
<li>This dataset provides detailed subdistrict boundaries for Jakarta, and contains population aggregated by subdistrict.</li>
</ul>
</section>
</section>
<section id="data-preprocessing" class="level2">
<h2 class="anchored" data-anchor-id="data-preprocessing">2.0 Data Preprocessing</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(sf, tidyverse, knitr, viridis, patchwork, gridExtra, kableExtra, sfdep, tmap, tmaptools, patchwork, scales, spdep, ggrepel, spatstat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>indo_schools_kaggle <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"data/aspatial/complete_data.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 215371 Columns: 11
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (6): province_name, city_name, district_name, school_name, stage, status
dbl (5): lat, long, province_area, total_population, total_education_age_pop...

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
</div>
<p>After loading the data for Indonesia schools, we will filter and preprocess the data to focus on Jakarta schools and clean the administrative boundaries data. We will <strong>exclude Jakarta’s Thousand Islands (Kab. Kepulauan Seribu)</strong> since they are primarily resort islands with limited educational facilities.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>jakarta_schools <span class="ot">&lt;-</span> indo_schools_kaggle <span class="sc">%&gt;%</span> </span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(province_name <span class="sc">==</span> <span class="st">"DKI JAKARTA"</span>,</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>         city_name <span class="sc">!=</span> <span class="st">"Kab. Kepulauan Seribu"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(long) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(lat)) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">"long"</span>, <span class="st">"lat"</span>), <span class="at">crs =</span> <span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">school_level =</span> <span class="fu">case_when</span>(</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        stage <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"SD"</span>, <span class="st">"SDLB"</span>) <span class="sc">~</span> <span class="st">"Elementary"</span>,</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        stage <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"SMP"</span>, <span class="st">"SMPLB"</span>) <span class="sc">~</span> <span class="st">"Junior High"</span>,</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        stage <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"SMA"</span>, <span class="st">"SMK"</span>, <span class="st">"SMLB"</span>) <span class="sc">~</span> <span class="st">"Senior High"</span>,</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">"Special Education"</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>      ),</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">school_type =</span> <span class="fu">if_else</span>(status <span class="sc">==</span> <span class="st">"N"</span>, <span class="st">"Public"</span>, <span class="st">"Private"</span>)</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>    )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(jakarta_schools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 11 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 106.8139 ymin: -6.1992 xmax: 106.8642 ymax: -6.1462
Geodetic CRS:  WGS 84
# A tibble: 6 × 12
  province_name city_name   district_name school_name stage status province_area
  &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt;         &lt;chr&gt;       &lt;chr&gt; &lt;chr&gt;          &lt;dbl&gt;
1 DKI JAKARTA   Kota Jakar… Kec. Tanah A… SD NEGERI … SD    N                664
2 DKI JAKARTA   Kota Jakar… Kec. Senen    SDN Kenari… SD    N                664
3 DKI JAKARTA   Kota Jakar… Kec. Johar B… SD NEGERI … SD    N                664
4 DKI JAKARTA   Kota Jakar… Kec. Menteng  SMAS PSKD … SMA   S                664
5 DKI JAKARTA   Kota Jakar… Kec. Sawah B… SMKS STRAD… SMK   S                664
6 DKI JAKARTA   Kota Jakar… Kec. Cempaka… SDN Cempak… SD    N                664
# ℹ 5 more variables: total_population &lt;dbl&gt;,
#   total_education_age_population &lt;dbl&gt;, geometry &lt;POINT [°]&gt;,
#   school_level &lt;chr&gt;, school_type &lt;chr&gt;</code></pre>
</div>
</div>
<p>Next, we load the administrative boundaries data for Jakarta and filter the relevant districts for our analysis.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>adm2 <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial"</span>, <span class="at">layer =</span> <span class="st">"geoBoundaries-IDN-ADM2_simplified"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(shapeName <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Kota Jakarta Barat"</span>, <span class="st">"Kota Jakarta Pusat"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Kota Jakarta Selatan"</span>, <span class="st">"Kota Jakarta Timur"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Kota Jakarta Utara"</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `geoBoundaries-IDN-ADM2_simplified' from data source 
  `C:\Users\yeoba\Desktop\bjyeo\IS415-GeospatialAnalytics\TakehomeEx\THE03C\data\geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 519 features and 5 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 95.01115 ymin: -11.00762 xmax: 141.0194 ymax: 6.07693
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<p>Our last dataset, the subdistrict data, provides detailed boundaries for Jakarta’s subdistricts. We will use this data to analyze population density and other demographic factors. The original dataset has column names in Indonesian, so we will need to rename them for consistency.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>batas <span class="ot">&lt;-</span> <span class="fu">st_read</span>(<span class="st">"data/geospatial"</span>, <span class="at">layer =</span> <span class="st">"BATAS_DESA_DESEMBER_2019_DUKCAPIL_DKI_JAKARTA"</span>)  <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(OBJECT_ID, PROVINSI, KAB_KOTA, KECAMATAN, DESA_KELUR, </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>         JUMLAH_PEN, JUMLAH_KK, LUAS_WILAY, KEPADATAN, geometry) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">rename</span>(</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">province =</span> PROVINSI,</span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">city =</span> KAB_KOTA,</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">district =</span> KECAMATAN,</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">subdistrict =</span> DESA_KELUR,</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">population =</span> JUMLAH_PEN,</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_families =</span> JUMLAH_KK,</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">area_size =</span> LUAS_WILAY,</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">popn_density =</span> KEPADATAN</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(city) <span class="sc">&amp;</span> city <span class="sc">!=</span> <span class="st">"KEPULAUAN SERIBU"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">city =</span> <span class="fu">case_when</span>(</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>      city <span class="sc">==</span> <span class="st">"JAKARTA BARAT"</span> <span class="sc">~</span> <span class="st">"Kota Jakarta Barat"</span>,</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>      city <span class="sc">==</span> <span class="st">"JAKARTA PUSAT"</span> <span class="sc">~</span> <span class="st">"Kota Jakarta Pusat"</span>,</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a>      city <span class="sc">==</span> <span class="st">"JAKARTA SELATAN"</span> <span class="sc">~</span> <span class="st">"Kota Jakarta Selatan"</span>,</span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>      city <span class="sc">==</span> <span class="st">"JAKARTA TIMUR"</span> <span class="sc">~</span> <span class="st">"Kota Jakarta Timur"</span>,</span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>      city <span class="sc">==</span> <span class="st">"JAKARTA UTARA"</span> <span class="sc">~</span> <span class="st">"Kota Jakarta Utara"</span>,</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>      <span class="cn">TRUE</span> <span class="sc">~</span> city</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>    ))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `BATAS_DESA_DESEMBER_2019_DUKCAPIL_DKI_JAKARTA' from data source 
  `C:\Users\yeoba\Desktop\bjyeo\IS415-GeospatialAnalytics\TakehomeEx\THE03C\data\geospatial' 
  using driver `ESRI Shapefile'
Simple feature collection with 269 features and 161 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 106.3831 ymin: -6.370815 xmax: 106.9728 ymax: -5.184322
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(batas)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 6 features and 9 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 106.8105 ymin: -6.17575 xmax: 106.8711 ymax: -6.141043
Geodetic CRS:  WGS 84
  OBJECT_ID    province               city    district   subdistrict population
1     25477 DKI JAKARTA Kota Jakarta Barat  TAMAN SARI     KEAGUNGAN      21609
2     25478 DKI JAKARTA Kota Jakarta Barat  TAMAN SARI        GLODOK       9069
3     25397 DKI JAKARTA Kota Jakarta Pusat   KEMAYORAN HARAPAN MULIA      29085
4     25400 DKI JAKARTA Kota Jakarta Pusat   KEMAYORAN  CEMPAKA BARU      41913
5     25390 DKI JAKARTA Kota Jakarta Pusat SAWAH BESAR    PASAR BARU      15793
6     25391 DKI JAKARTA Kota Jakarta Pusat SAWAH BESAR  KARANG ANYAR      33383
  total_families area_size popn_density                       geometry
1           7255      0.36        60504 MULTIPOLYGON (((106.8164 -6...
2           3273      0.37        24527 MULTIPOLYGON (((106.8148 -6...
3           9217      0.53        54465 MULTIPOLYGON (((106.8576 -6...
4          13766      0.97        42993 MULTIPOLYGON (((106.8631 -6...
5           5599      1.76         8971 MULTIPOLYGON (((106.8369 -6...
6          11276      0.47        71628 MULTIPOLYGON (((106.8316 -6...</code></pre>
</div>
</div>
<p>The district names in the batas dataset is cleaned to ensure consistency.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>district_mapping <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TAMAN SARI"</span> <span class="ot">=</span> <span class="st">"Kec. Taman Sari"</span>,</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KEMAYORAN"</span> <span class="ot">=</span> <span class="st">"Kec. Kemayoran"</span>,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SAWAH BESAR"</span> <span class="ot">=</span> <span class="st">"Kec. Sawah Besar"</span>,</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GAMBIR"</span> <span class="ot">=</span> <span class="st">"Kec. Gambir"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SENEN"</span> <span class="ot">=</span> <span class="st">"Kec. Senen"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CEMPAKA PUTIH"</span> <span class="ot">=</span> <span class="st">"Kec. Cempaka Putih"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">"MENTENG"</span> <span class="ot">=</span> <span class="st">"Kec. Menteng"</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TANAH ABANG"</span> <span class="ot">=</span> <span class="st">"Kec. Tanah Abang"</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    <span class="st">"JOHAR BARU"</span> <span class="ot">=</span> <span class="st">"Kec. Johar Baru"</span>,</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KOJA"</span> <span class="ot">=</span> <span class="st">"Kec. Koja"</span>,</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PENJARINGAN"</span> <span class="ot">=</span> <span class="st">"Kec. Penjaringan"</span>,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TANJUNG PRIOK"</span> <span class="ot">=</span> <span class="st">"Kec. Tanjung Priok"</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CILINCING"</span> <span class="ot">=</span> <span class="st">"Kec. Cilincing"</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">"GROGOL PETAMBURAN"</span> <span class="ot">=</span> <span class="st">"Kec. Grogol Petamburan"</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PADEMANGAN"</span> <span class="ot">=</span> <span class="st">"Kec. Pademangan"</span>,</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KELAPA GADING"</span> <span class="ot">=</span> <span class="st">"Kec. Kelapa Gading"</span>,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CENGKARENG"</span> <span class="ot">=</span> <span class="st">"Kec. Cengkareng"</span>,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TAMBORA"</span> <span class="ot">=</span> <span class="st">"Kec. Tambora"</span>,</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KEBON JERUK"</span> <span class="ot">=</span> <span class="st">"Kec. Kebon Jeruk"</span>,</span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KALIDERES"</span> <span class="ot">=</span> <span class="st">"Kec. Kali Deres"</span>,</span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PAL MERAH"</span> <span class="ot">=</span> <span class="st">"Kec. Palmerah"</span>,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>    <span class="st">"JATINEGARA"</span> <span class="ot">=</span> <span class="st">"Kec. Jatinegara"</span>,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KEMBANGAN"</span> <span class="ot">=</span> <span class="st">"Kec. Kembangan"</span>,</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a>    <span class="st">"TEBET"</span> <span class="ot">=</span> <span class="st">"Kec. Tebet"</span>,</span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a>    <span class="st">"SETIABUDI"</span> <span class="ot">=</span> <span class="st">"Kec. Setia Budi"</span>,</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a>    <span class="st">"MAMPANG PRAPATAN"</span> <span class="ot">=</span> <span class="st">"Kec. Mampang Prapatan"</span>,</span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PASAR MINGGU"</span> <span class="ot">=</span> <span class="st">"Kec. Pasar Minggu"</span>,</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KEBAYORAN LAMA"</span> <span class="ot">=</span> <span class="st">"Kec. Kebayoran Lama"</span>,</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KEBAYORAN BARU"</span> <span class="ot">=</span> <span class="st">"Kec. Kebayoran Baru"</span>,</span>
<span id="cb13-31"><a href="#cb13-31" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CILANDAK"</span> <span class="ot">=</span> <span class="st">"Kec. Cilandak"</span>,</span>
<span id="cb13-32"><a href="#cb13-32" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PESANGGRAHAN"</span> <span class="ot">=</span> <span class="st">"Kec. Pesanggrahan"</span>,</span>
<span id="cb13-33"><a href="#cb13-33" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PANCORAN"</span> <span class="ot">=</span> <span class="st">"Kec. Pancoran"</span>,</span>
<span id="cb13-34"><a href="#cb13-34" aria-hidden="true" tabindex="-1"></a>    <span class="st">"JAGAKARSA"</span> <span class="ot">=</span> <span class="st">"Kec. Jagakarsa"</span>,</span>
<span id="cb13-35"><a href="#cb13-35" aria-hidden="true" tabindex="-1"></a>    <span class="st">"MATRAMAN"</span> <span class="ot">=</span> <span class="st">"Kec. Matraman"</span>,</span>
<span id="cb13-36"><a href="#cb13-36" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PULOGADUNG"</span> <span class="ot">=</span> <span class="st">"Kec. Pulo Gadung"</span>,</span>
<span id="cb13-37"><a href="#cb13-37" aria-hidden="true" tabindex="-1"></a>    <span class="st">"KRAMATJATI"</span> <span class="ot">=</span> <span class="st">"Kec. Kramat Jati"</span>,</span>
<span id="cb13-38"><a href="#cb13-38" aria-hidden="true" tabindex="-1"></a>    <span class="st">"PASAR REBO"</span> <span class="ot">=</span> <span class="st">"Kec. Pasar Rebo"</span>,</span>
<span id="cb13-39"><a href="#cb13-39" aria-hidden="true" tabindex="-1"></a>    <span class="st">"DUREN SAWIT"</span> <span class="ot">=</span> <span class="st">"Kec. Duren Sawit"</span>,</span>
<span id="cb13-40"><a href="#cb13-40" aria-hidden="true" tabindex="-1"></a>    <span class="st">"MAKASAR"</span> <span class="ot">=</span> <span class="st">"Kec. Makasar"</span>,</span>
<span id="cb13-41"><a href="#cb13-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CIRACAS"</span> <span class="ot">=</span> <span class="st">"Kec. Ciracas"</span>,</span>
<span id="cb13-42"><a href="#cb13-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CIPAYUNG"</span> <span class="ot">=</span> <span class="st">"Kec. Cipayung"</span>,</span>
<span id="cb13-43"><a href="#cb13-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">"CAKUNG"</span> <span class="ot">=</span> <span class="st">"Kec. Cakung"</span></span>
<span id="cb13-44"><a href="#cb13-44" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-45"><a href="#cb13-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-46"><a href="#cb13-46" aria-hidden="true" tabindex="-1"></a>batas <span class="ot">&lt;-</span> batas <span class="sc">%&gt;%</span></span>
<span id="cb13-47"><a href="#cb13-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">district =</span> district_mapping[district])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="exploratory-data-analysis-provincial-level" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis-provincial-level">3.0 Exploratory Data Analysis (Provincial Level)</h2>
<p>Before diving into detailed spatial analysis, we will conduct an initial round of analysis at the provincial level to understand the overall distribution of schools across Jakarta.</p>
<section id="overall-distribution-patterns" class="level3">
<h3 class="anchored" data-anchor-id="overall-distribution-patterns">3.1 Overall Distribution Patterns</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> jakarta_schools) <span class="sc">+</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> city_name, <span class="at">fill =</span> city_name)) <span class="sc">+</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of Schools Across Jakarta"</span>,</span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"City"</span>,</span>
<span id="cb14-13"><a href="#cb14-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Schools"</span></span>
<span id="cb14-14"><a href="#cb14-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong>:</p>
<ul>
<li>East Jakarta has the highest concentration of schools (approximately 1200+), followed by West Jakarta</li>
<li>The distribution aligns broadly with population density but shows some notable mismatches</li>
<li>School density follows an east-west corridor pattern with lower density in the north and south</li>
</ul>
</section>
<section id="school-level-distribution" class="level3">
<h3 class="anchored" data-anchor-id="school-level-distribution">3.2 School Level Distribution</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> jakarta_schools) <span class="sc">+</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> city_name, <span class="at">fill =</span> school_level)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Distribution of School Levels Across Jakarta"</span>,</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"City"</span>,</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Number of Schools"</span>,</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"School Level"</span></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong>:</p>
<ul>
<li>Across all municipalities, elementary schools are the most common</li>
<li>There is a relatively consistent proportion of Junior and Senior High Schools</li>
<li>Special Education schools are less common but present in all municipalities</li>
<li>While total numbers differ, the proportional distribution of school levels remains fairly consistent across cities, suggesting <strong>planned distribution</strong> rather than random clustering</li>
</ul>
</section>
<section id="overall-school-density" class="level3">
<h3 class="anchored" data-anchor-id="overall-school-density">3.3 Overall School Density</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> adm2, <span class="fu">aes</span>(<span class="at">fill =</span> <span class="fu">lengths</span>(<span class="fu">st_intersects</span>(adm2, jakarta_schools)))) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"School Density Across Jakarta"</span>,</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Number of</span><span class="sc">\n</span><span class="st">Schools"</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="population-density" class="level3">
<h3 class="anchored" data-anchor-id="population-density">3.4 Population Density</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> batas, <span class="fu">aes</span>(<span class="at">fill =</span> popn_density)) <span class="sc">+</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">"plasma"</span>,</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Population Density in Jakarta"</span>,</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Population</span><span class="sc">\n</span><span class="st">Density</span><span class="sc">\n</span><span class="st">(per km²)"</span></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong>:</p>
<ul>
<li>The density map reveals high population clusters in central Jakarta (yellow/orange areas)</li>
<li>There is an interesting mismatch with school density in some areas</li>
<li>Several high-density pockets are scattered across Jakarta</li>
</ul>
</section>
<section id="overall-summary" class="level3">
<h3 class="anchored" data-anchor-id="overall-summary">3.5 Overall Summary</h3>
<ul>
<li>Our preliminary EDA at the provincial level is too macro to provide detailed insights, but necessary to understand the overall distribution of schools in Jakarta</li>
<li>Certain patterns of school and population concentration emerge, but we will need to confirm this with KDE and statistical tests</li>
<li>We still cannot determine if the school distribution matches population needs</li>
</ul>
</section>
</section>
<section id="kernel-density-estimation-provincial-level" class="level2">
<h2 class="anchored" data-anchor-id="kernel-density-estimation-provincial-level">4.0 Kernel Density Estimation (Provincial Level)</h2>
<p>To analyze the spatial distribution of schools in Jakarta, we will use Kernel Density Estimation (KDE) to identify clustering patterns and hotspots. We will conduct KDE analysis at the provincial level and then drill down to individual cities to understand local variations.</p>
<section id="provincial-kde" class="level3">
<h3 class="anchored" data-anchor-id="provincial-kde">4.1 Provincial KDE</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Convert to UTM projection for proper distance calculations</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>jakarta_schools_utm <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(jakarta_schools, <span class="dv">32748</span>)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>adm2_utm <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(adm2, <span class="dv">32748</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>proper_jitter <span class="ot">&lt;-</span> <span class="cf">function</span>(sf_points, window) {</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Convert points to spatial points pattern</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  jittered_points <span class="ot">&lt;-</span> <span class="fu">st_jitter</span>(sf_points, <span class="at">amount =</span> <span class="dv">1</span>)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(jittered_points)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter points within window</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>  inside <span class="ot">&lt;-</span> <span class="fu">inside.owin</span>(<span class="at">x =</span> coords[,<span class="dv">1</span>], <span class="at">y =</span> coords[,<span class="dv">2</span>], <span class="at">w =</span> window)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">sum</span>(inside) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    valid_coords <span class="ot">&lt;-</span> coords[inside,]</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create ppp object</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>    points_ppp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> valid_coords[,<span class="dv">1</span>],</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> valid_coords[,<span class="dv">2</span>],</span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">window =</span> window</span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>      <span class="at">points_ppp =</span> points_ppp,</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">inside_count =</span> <span class="fu">sum</span>(inside)</span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"No points fall within the window after jittering"</span>)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>kde_analysis <span class="ot">&lt;-</span> <span class="cf">function</span>(jakarta_schools_utm, adm2_utm) {</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create window</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  window <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(<span class="fu">st_union</span>(adm2_utm))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get point pattern</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  jittered_result <span class="ot">&lt;-</span> <span class="fu">proper_jitter</span>(jakarta_schools_utm, window)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>  points <span class="ot">&lt;-</span> jittered_result<span class="sc">$</span>points_ppp</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  inside_count <span class="ot">&lt;-</span> jittered_result<span class="sc">$</span>inside_count</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Verify points exist</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(points<span class="sc">$</span>n <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate KDE</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>    kde <span class="ot">&lt;-</span> <span class="fu">density.ppp</span>(points, </span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sigma =</span> <span class="fu">bw.diggle</span>(points),</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>                      <span class="at">edge =</span> <span class="cn">TRUE</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>    kde_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(kde)</span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">list</span>(</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">kde_df =</span> kde_df,</span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">inside_count =</span> inside_count</span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a>    ))</span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">stop</span>(<span class="st">"No valid points for KDE analysis"</span>)</span>
<span id="cb20-25"><a href="#cb20-25" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb20-26"><a href="#cb20-26" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>kde_result <span class="ot">&lt;-</span> <span class="fu">kde_analysis</span>(jakarta_schools_utm, adm2_utm)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> adm2_utm, <span class="at">fill =</span> <span class="st">"transparent"</span>) <span class="sc">+</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_tile</span>(<span class="at">data =</span> kde_result<span class="sc">$</span>kde_df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Kernel Density Estimation of All Schools"</span>,</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"Based on "</span>, kde_result<span class="sc">$</span>inside_count, <span class="st">" school locations"</span>),</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"Density"</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong>:</p>
<ul>
<li>The overall KDE map shows spatial clustering with several high-density hotspots</li>
<li>The strongest concentration is in North-Central Jakarta (around 6.15S)</li>
<li>Secondary clusters appear in the eastern and western regions</li>
<li>Southern areas generally show lower density</li>
<li>This patterns strongly suggests rejecting the null hypothesis of random distribution</li>
</ul>
</section>
<section id="kde-by-school-level" class="level3">
<h3 class="anchored" data-anchor-id="kde-by-school-level">4.2 KDE by School Level</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Function for KDE by school level</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>kde_by_level <span class="ot">&lt;-</span> <span class="cf">function</span>(jakarta_schools_utm, adm2_utm) {</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>  window <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(<span class="fu">st_union</span>(adm2_utm))</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>  kde_plots <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(level <span class="cf">in</span> <span class="fu">unique</span>(jakarta_schools_utm<span class="sc">$</span>school_level)) {</span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Subset schools by level</span></span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a>    schools_subset <span class="ot">&lt;-</span> jakarta_schools_utm[jakarta_schools_utm<span class="sc">$</span>school_level <span class="sc">==</span> level,]</span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Jitter points</span></span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>    jittered_result <span class="ot">&lt;-</span> <span class="fu">proper_jitter</span>(schools_subset, window)</span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>    points_ppp <span class="ot">&lt;-</span> jittered_result<span class="sc">$</span>points_ppp</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate KDE</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>    kde_level <span class="ot">&lt;-</span> <span class="fu">density.ppp</span>(points_ppp,</span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>                            <span class="at">sigma =</span> <span class="fu">bw.diggle</span>(points_ppp),</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>                            <span class="at">edge =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>    kde_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(kde_level)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create plot</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>    kde_plots[[level]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> adm2_utm, <span class="at">fill =</span> <span class="st">"transparent"</span>) <span class="sc">+</span></span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>(<span class="at">data =</span> kde_df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(</span>
<span id="cb22-27"><a href="#cb22-27" aria-hidden="true" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"School Density:"</span>, level),</span>
<span id="cb22-28"><a href="#cb22-28" aria-hidden="true" tabindex="-1"></a>        <span class="at">subtitle =</span> <span class="fu">paste0</span>(<span class="st">"Based on "</span>, jittered_result<span class="sc">$</span>inside_count, <span class="st">" school locations"</span>),</span>
<span id="cb22-29"><a href="#cb22-29" aria-hidden="true" tabindex="-1"></a>        <span class="at">fill =</span> <span class="st">"Density"</span></span>
<span id="cb22-30"><a href="#cb22-30" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb22-31"><a href="#cb22-31" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb22-32"><a href="#cb22-32" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb22-33"><a href="#cb22-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(kde_plots)</span>
<span id="cb22-34"><a href="#cb22-34" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb22-35"><a href="#cb22-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-36"><a href="#cb22-36" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(<span class="fu">kde_by_level</span>(jakarta_schools_utm, adm2_utm), print)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-17-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-17-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-17-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-17-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong>:</p>
<ul>
<li>The KDE plots reveal distinct non-random spatial patterns in school distribution</li>
<li>The most intense clustering appears in the North-Central region across all school types</li>
<li>Density patterns vary by school level. Elementary schools show more dispersed, localized hotspots. Secondary schools display stronger clustering and special education schools show unique clustering patterns in central and southwestern regions.</li>
</ul>
</section>
<section id="quadrat-analysis" class="level3">
<h3 class="anchored" data-anchor-id="quadrat-analysis">4.3 Quadrat Analysis</h3>
<p><strong>Spatial Distribution</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>jittered_schools <span class="ot">&lt;-</span> <span class="fu">st_jitter</span>(jakarta_schools_utm, <span class="at">amount =</span> <span class="dv">1</span>)</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(jittered_schools)</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>marks <span class="ot">&lt;-</span> jittered_schools<span class="sc">$</span>school_level</span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>window <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(<span class="fu">st_union</span>(adm2_utm))</span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter points within window</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>inside <span class="ot">&lt;-</span> <span class="fu">inside.owin</span>(<span class="at">x =</span> coords[,<span class="dv">1</span>], <span class="at">y =</span> coords[,<span class="dv">2</span>], <span class="at">w =</span> window)</span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>valid_coords <span class="ot">&lt;-</span> coords[inside,]</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a>valid_marks <span class="ot">&lt;-</span> marks[inside]</span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Number of valid coordinates:"</span>, <span class="fu">nrow</span>(valid_coords)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of valid coordinates: 4734"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Number of valid marks:"</span>, <span class="fu">length</span>(valid_marks)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Number of valid marks: 4734"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>quadrat_points <span class="ot">&lt;-</span> <span class="fu">ppp</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> valid_coords[,<span class="dv">1</span>],</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> valid_coords[,<span class="dv">2</span>],</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">window =</span> window,</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">marks =</span> <span class="fu">factor</span>(valid_marks)</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>q <span class="ot">&lt;-</span> <span class="fu">quadratcount</span>(quadrat_points, <span class="at">nx =</span> <span class="dv">6</span>, <span class="at">ny =</span> <span class="dv">6</span>)</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> adm2_utm, <span class="at">fill =</span> <span class="st">"transparent"</span>) <span class="sc">+</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_density2d</span>(</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">as.data.frame</span>(valid_coords),</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">fill =</span> <span class="fu">after_stat</span>(level)),</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">geom =</span> <span class="st">"polygon"</span>,</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.5</span>,</span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">contour =</span> <span class="cn">TRUE</span></span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">data =</span> <span class="fu">data.frame</span>(</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">X =</span> valid_coords[,<span class="dv">1</span>],</span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">Y =</span> valid_coords[,<span class="dv">2</span>],</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">Level =</span> valid_marks</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">x =</span> X, <span class="at">y =</span> Y, <span class="at">color =</span> Level),</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.6</span>,</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">2</span></span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">name =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">name =</span> <span class="st">"School Level"</span>) <span class="sc">+</span></span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Quadrat Analysis of Schools in Jakarta"</span>,</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Based on"</span>, <span class="fu">nrow</span>(valid_coords), <span class="st">" school locations"</span>)</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-19-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong>:</p>
<ul>
<li>The quadrat analysis confirms the non-random distribution of schools in Jakarta</li>
<li>Elementary schools show widest spatial coverage, secondary schools tend to be clustered together and special education facilities are sparsely distributed</li>
<li>Higher density areas correspond to areas with multiple school types</li>
</ul>
<p><strong>Statistical Analysis</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Chi-square test</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>q_test <span class="ot">&lt;-</span> <span class="fu">quadrat.test</span>(quadrat_points)</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(<span class="st">"Quadrat Test Results:"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Quadrat Test Results:"</code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(q_test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Chi-squared test of CSR using quadrat counts

data:  quadrat_points
X2 = 513.45, df = 22, p-value &lt; 2.2e-16
alternative hypothesis: two.sided

Quadrats: 23 tiles (irregular windows)</code></pre>
</div>
</div>
<p>From the Chi-squared test, the <strong>extremely low p-value</strong> &lt; 2.2e-16 strongly <strong>rejects the null hypothesis</strong> of Complete Spatial Randomness (CSR). The high chi-squared value of 513.45 indicates substantial deviation from expected frequencies. The results statistically confirm the visual clustering patterns.</p>
<p><strong>Frequency Analysis</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>quadrat_summary <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">observed =</span> <span class="fu">as.vector</span>(q),</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">expected =</span> <span class="fu">mean</span>(<span class="fu">as.vector</span>(q)),</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">quadrat =</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">as.vector</span>(q))</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(quadrat_summary) <span class="sc">+</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> quadrat, <span class="at">y =</span> observed), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="fu">mean</span>(quadrat_summary<span class="sc">$</span>expected), </span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>             <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Observed vs Expected Quadrat Frequencies"</span>,</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Quadrat Number"</span>,</span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Frequency"</span>,</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Red line indicates expected frequency under CSR"</span></span>
<span id="cb32-17"><a href="#cb32-17" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-21-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong>:</p>
<ul>
<li>There is <strong>large variation</strong> in observed frequencies across quadrats</li>
<li>Most quadrats show frequencies significantly different from expected (red line)</li>
<li>Several quadrats show very high frequencies (&gt;300 schools). Some quadrats show very low frequencies (&lt;100 schools)</li>
<li>This pattern suggests <strong>strong deviation from CSR</strong></li>
</ul>
</section>
</section>
<section id="exploratory-data-analysis-city-level" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis-city-level">5.0 Exploratory Data Analysis (City Level)</h2>
<p>To gain a more granular understanding of school distribution patterns, we will conduct a detailed analysis at the city level. By examining each city’s school network, we can identify local variations, assess the distribution of public vs private schools, and analyze nearest neighbor relationships.</p>
<section id="school-distribution-by-city" class="level3">
<h3 class="anchored" data-anchor-id="school-distribution-by-city">5.1 School Distribution by City</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create individual maps for each city</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>batas_utm <span class="ot">&lt;-</span> <span class="fu">st_transform</span>(batas, <span class="dv">32748</span>)</span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a>city_maps <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(city <span class="cf">in</span> <span class="fu">unique</span>(batas<span class="sc">$</span>city)) {</span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  city_boundary <span class="ot">&lt;-</span> batas_utm[batas_utm<span class="sc">$</span>city <span class="sc">==</span> city,]</span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a>  city_schools <span class="ot">&lt;-</span> jakarta_schools_utm[<span class="fu">st_intersects</span>(jakarta_schools_utm, </span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>                                                   <span class="fu">st_union</span>(city_boundary)) <span class="sc">%&gt;%</span> </span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a>                                      lengths <span class="sc">&gt;</span> <span class="dv">0</span>,]</span>
<span id="cb33-11"><a href="#cb33-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-12"><a href="#cb33-12" aria-hidden="true" tabindex="-1"></a>  city_maps[[city]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb33-13"><a href="#cb33-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> city_boundary, </span>
<span id="cb33-14"><a href="#cb33-14" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">fill =</span> popn_density)) <span class="sc">+</span></span>
<span id="cb33-15"><a href="#cb33-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> city_schools,</span>
<span id="cb33-16"><a href="#cb33-16" aria-hidden="true" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">color =</span> school_level),</span>
<span id="cb33-17"><a href="#cb33-17" aria-hidden="true" tabindex="-1"></a>            <span class="at">size =</span> <span class="dv">2</span>,</span>
<span id="cb33-18"><a href="#cb33-18" aria-hidden="true" tabindex="-1"></a>            <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span></span>
<span id="cb33-19"><a href="#cb33-19" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_c</span>(</span>
<span id="cb33-20"><a href="#cb33-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">option =</span> <span class="st">"plasma"</span>,</span>
<span id="cb33-21"><a href="#cb33-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"Population</span><span class="sc">\n</span><span class="st">Density"</span>,</span>
<span id="cb33-22"><a href="#cb33-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">comma_format</span>()</span>
<span id="cb33-23"><a href="#cb33-23" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb33-24"><a href="#cb33-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_d</span>(</span>
<span id="cb33-25"><a href="#cb33-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">option =</span> <span class="st">"plasma"</span>,</span>
<span id="cb33-26"><a href="#cb33-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">name =</span> <span class="st">"School Level"</span></span>
<span id="cb33-27"><a href="#cb33-27" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb33-28"><a href="#cb33-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb33-29"><a href="#cb33-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb33-30"><a href="#cb33-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb33-31"><a href="#cb33-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb33-32"><a href="#cb33-32" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb33-33"><a href="#cb33-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb33-34"><a href="#cb33-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>, <span class="dv">10</span>)</span>
<span id="cb33-35"><a href="#cb33-35" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb33-36"><a href="#cb33-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb33-37"><a href="#cb33-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Schools Distribution in"</span>, city),</span>
<span id="cb33-38"><a href="#cb33-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">"Number of schools:"</span>, <span class="fu">nrow</span>(city_schools))</span>
<span id="cb33-39"><a href="#cb33-39" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb33-40"><a href="#cb33-40" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb33-41"><a href="#cb33-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-42"><a href="#cb33-42" aria-hidden="true" tabindex="-1"></a><span class="co"># Display all maps</span></span>
<span id="cb33-43"><a href="#cb33-43" aria-hidden="true" tabindex="-1"></a><span class="fu">walk</span>(<span class="fu">names</span>(city_maps), <span class="cf">function</span>(city) {</span>
<span id="cb33-44"><a href="#cb33-44" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(city_maps[[city]])</span>
<span id="cb33-45"><a href="#cb33-45" aria-hidden="true" tabindex="-1"></a>})</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-22-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-22-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-22-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-22-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-22-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong></p>
<ul>
<li><strong>Jakarta Timur</strong>: Most extensive school network with even distribution across the region. There is strong correlation between population density and school locations. Notable clustering in central-north areas where population density reaches 40,000-60,000. Special education facilities well-distributed compared to other regions</li>
<li><strong>Jakarta Barat</strong>: Clear north-east educational corridor, dense clustering in eastern regions. Population density hotspots show good school coverage. Relatively even distribution of school levels.</li>
<li><strong>Jakarta Selatan</strong>: More dispersed distribution pattern, lower population density, higher proportion of senior high schools. Educational clusters observed in northern districts. Overall, good balance between school types and population needs.</li>
<li><strong>Jakarta Utara</strong>: Unique coastal-inland distribution pattern. Strong east-west variation in school density. Population density clusters in central areas. Limited special education facilities, clear correlation between major roads and school locations.</li>
<li><strong>Jakarta Pusat</strong>: Highest concentration of schools per unit area, intense clustering in eastern districts. Strong alignment with high population density. Notable educational complexes, since there are multiple school levels in close proximity. However, limited coverage in western sectors.</li>
</ul>
</section>
<section id="public-school-ratio-by-city" class="level3">
<h3 class="anchored" data-anchor-id="public-school-ratio-by-city">5.2 Public School Ratio by City</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>public_ratio <span class="ot">&lt;-</span> jakarta_schools_utm <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(city_name) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">total_schools =</span> <span class="fu">n</span>(),</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">public_schools =</span> <span class="fu">sum</span>(school_type <span class="sc">==</span> <span class="st">"Public"</span>),</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">public_ratio =</span> public_schools <span class="sc">/</span> total_schools,</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(public_ratio) <span class="sc">+</span></span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(city_name, public_ratio), </span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> public_ratio, </span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> city_name), </span>
<span id="cb34-14"><a href="#cb34-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb34-15"><a href="#cb34-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb34-16"><a href="#cb34-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb34-17"><a href="#cb34-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb34-18"><a href="#cb34-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb34-19"><a href="#cb34-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span>,</span>
<span id="cb34-20"><a href="#cb34-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb34-21"><a href="#cb34-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.subtitle =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>)</span>
<span id="cb34-22"><a href="#cb34-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb34-23"><a href="#cb34-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb34-24"><a href="#cb34-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Public School Ratio by City"</span>,</span>
<span id="cb34-25"><a href="#cb34-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Proportion of public schools to total schools"</span>,</span>
<span id="cb34-26"><a href="#cb34-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"City"</span>,</span>
<span id="cb34-27"><a href="#cb34-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Proportion of Public Schools"</span></span>
<span id="cb34-28"><a href="#cb34-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-23-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong>:</p>
<ul>
<li>The public school ratio varies significantly across cities</li>
<li>The highest ratios is in Jakarta Selatan, which is surprisingly since South Jakarta has the third highest population in Jakarta</li>
<li>This suggests an uneven distribution of public education resources</li>
</ul>
</section>
<section id="nearest-neighbour-analysis" class="level3">
<h3 class="anchored" data-anchor-id="nearest-neighbour-analysis">5.3 Nearest Neighbour Analysis</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>nn_analysis <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(city <span class="cf">in</span> <span class="fu">unique</span>(jakarta_schools_utm<span class="sc">$</span>city_name)) {</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get schools for this city</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  city_schools <span class="ot">&lt;-</span> jakarta_schools_utm[jakarta_schools_utm<span class="sc">$</span>city_name <span class="sc">==</span> city,]</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>  city_boundary <span class="ot">&lt;-</span> adm2_utm[adm2_utm<span class="sc">$</span>shapeName <span class="sc">==</span> city,]</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  city_window <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(<span class="fu">st_union</span>(city_boundary))</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Jitter points properly</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>  jittered_result <span class="ot">&lt;-</span> <span class="fu">proper_jitter</span>(city_schools, city_window)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  points_ppp <span class="ot">&lt;-</span> jittered_result<span class="sc">$</span>points_ppp</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Store results</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  nn_analysis[[city]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">city =</span> city,</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">observed_mean_dist =</span> <span class="fu">mean</span>(<span class="fu">nndist</span>(points_ppp)),</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_points =</span> <span class="fu">npoints</span>(points_ppp),</span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">area =</span> <span class="fu">area.owin</span>(city_window),</span>
<span id="cb35-18"><a href="#cb35-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">expected_mean_dist =</span> <span class="dv">1</span><span class="sc">/</span>(<span class="dv">2</span><span class="sc">*</span><span class="fu">sqrt</span>(<span class="fu">npoints</span>(points_ppp)<span class="sc">/</span><span class="fu">area.owin</span>(city_window))),</span>
<span id="cb35-19"><a href="#cb35-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb35-20"><a href="#cb35-20" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb35-21"><a href="#cb35-21" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-22"><a href="#cb35-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-23"><a href="#cb35-23" aria-hidden="true" tabindex="-1"></a>nn_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(nn_analysis) <span class="sc">%&gt;%</span></span>
<span id="cb35-24"><a href="#cb35-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">R =</span> observed_mean_dist<span class="sc">/</span>expected_mean_dist)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>nn_df <span class="sc">%&gt;%</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(city, observed_mean_dist, n_points, expected_mean_dist, R) <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(R) <span class="sc">%&gt;%</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable</span>(<span class="st">"html"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">kable_styling</span>(<span class="st">"striped"</span>, <span class="at">full_width =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nn_df) <span class="sc">+</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(city, R), <span class="at">y =</span> R, <span class="at">fill =</span> city),</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Nearest Neighbor Analysis by City"</span>,</span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"R &lt; 1 indicates clustering, R &gt; 1 indicates dispersion"</span>,</span>
<span id="cb37-14"><a href="#cb37-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"City"</span>,</span>
<span id="cb37-15"><a href="#cb37-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"R Statistic"</span></span>
<span id="cb37-16"><a href="#cb37-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(nn_df) <span class="sc">+</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="fu">aes</span>(<span class="at">x =</span> city, <span class="at">xend =</span> city,</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>                   <span class="at">y =</span> expected_mean_dist, <span class="at">yend =</span> observed_mean_dist),</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">color =</span> <span class="st">"gray50"</span>) <span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> city, <span class="at">y =</span> expected_mean_dist), <span class="at">color =</span> <span class="st">"blue"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> city, <span class="at">y =</span> observed_mean_dist), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Expected vs Observed Mean Nearest Neighbor Distances"</span>,</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Blue: Expected, Red: Observed"</span>,</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"City"</span>,</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Distance (meters)"</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong>:</p>
<ul>
<li>All cities show an R-value &lt; 1 confirming significant clustering</li>
<li>The strongest clustering is in Jakarta Pusat (0.48) and most dispersed in Jakarta Barat (0.67)</li>
<li>All cities show observed distances significantly lower than expected, confirming non-random distribution</li>
</ul>
</section>
<section id="cross-k-function-analysis" class="level3">
<h3 class="anchored" data-anchor-id="cross-k-function-analysis">5.4 Cross K Function Analysis</h3>
<p><strong>Public vs Private Schools</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enhanced Cross K Analysis of Public vs Private Schools by City</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>cross_k_status <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(city <span class="cf">in</span> <span class="fu">unique</span>(jakarta_schools_utm<span class="sc">$</span>city_name)) {</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get schools for this city</span></span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>  city_schools <span class="ot">&lt;-</span> jakarta_schools_utm[jakarta_schools_utm<span class="sc">$</span>city_name <span class="sc">==</span> city,]</span>
<span id="cb39-7"><a href="#cb39-7" aria-hidden="true" tabindex="-1"></a>  city_boundary <span class="ot">&lt;-</span> adm2_utm[adm2_utm<span class="sc">$</span>shapeName <span class="sc">==</span> city,]</span>
<span id="cb39-8"><a href="#cb39-8" aria-hidden="true" tabindex="-1"></a>  city_window <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(<span class="fu">st_union</span>(city_boundary))</span>
<span id="cb39-9"><a href="#cb39-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-10"><a href="#cb39-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Separate public and private schools</span></span>
<span id="cb39-11"><a href="#cb39-11" aria-hidden="true" tabindex="-1"></a>  public_schools <span class="ot">&lt;-</span> city_schools[city_schools<span class="sc">$</span>school_type <span class="sc">==</span> <span class="st">"Public"</span>,]</span>
<span id="cb39-12"><a href="#cb39-12" aria-hidden="true" tabindex="-1"></a>  private_schools <span class="ot">&lt;-</span> city_schools[city_schools<span class="sc">$</span>school_type <span class="sc">==</span> <span class="st">"Private"</span>,]</span>
<span id="cb39-13"><a href="#cb39-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-14"><a href="#cb39-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add jitter to coordinates</span></span>
<span id="cb39-15"><a href="#cb39-15" aria-hidden="true" tabindex="-1"></a>  public_coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(public_schools)</span>
<span id="cb39-16"><a href="#cb39-16" aria-hidden="true" tabindex="-1"></a>  private_coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(private_schools)</span>
<span id="cb39-17"><a href="#cb39-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-18"><a href="#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Filter points within window</span></span>
<span id="cb39-19"><a href="#cb39-19" aria-hidden="true" tabindex="-1"></a>  public_inside <span class="ot">&lt;-</span> <span class="fu">inside.owin</span>(<span class="at">x =</span> public_coords[,<span class="dv">1</span>], <span class="at">y =</span> public_coords[,<span class="dv">2</span>], <span class="at">w =</span> city_window)</span>
<span id="cb39-20"><a href="#cb39-20" aria-hidden="true" tabindex="-1"></a>  private_inside <span class="ot">&lt;-</span> <span class="fu">inside.owin</span>(<span class="at">x =</span> private_coords[,<span class="dv">1</span>], <span class="at">y =</span> private_coords[,<span class="dv">2</span>], <span class="at">w =</span> city_window)</span>
<span id="cb39-21"><a href="#cb39-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-22"><a href="#cb39-22" aria-hidden="true" tabindex="-1"></a>  public_valid <span class="ot">&lt;-</span> public_coords[public_inside,]</span>
<span id="cb39-23"><a href="#cb39-23" aria-hidden="true" tabindex="-1"></a>  private_valid <span class="ot">&lt;-</span> private_coords[private_inside,]</span>
<span id="cb39-24"><a href="#cb39-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb39-25"><a href="#cb39-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create point pattern if we have valid points</span></span>
<span id="cb39-26"><a href="#cb39-26" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(public_valid) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(private_valid) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb39-27"><a href="#cb39-27" aria-hidden="true" tabindex="-1"></a>    points_ppp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(</span>
<span id="cb39-28"><a href="#cb39-28" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="fu">c</span>(public_valid[,<span class="dv">1</span>], private_valid[,<span class="dv">1</span>]),</span>
<span id="cb39-29"><a href="#cb39-29" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="fu">c</span>(public_valid[,<span class="dv">2</span>], private_valid[,<span class="dv">2</span>]),</span>
<span id="cb39-30"><a href="#cb39-30" aria-hidden="true" tabindex="-1"></a>      <span class="at">window =</span> city_window,</span>
<span id="cb39-31"><a href="#cb39-31" aria-hidden="true" tabindex="-1"></a>      <span class="at">marks =</span> <span class="fu">factor</span>(<span class="fu">c</span>(</span>
<span id="cb39-32"><a href="#cb39-32" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rep</span>(<span class="st">"Public"</span>, <span class="fu">nrow</span>(public_valid)),</span>
<span id="cb39-33"><a href="#cb39-33" aria-hidden="true" tabindex="-1"></a>        <span class="fu">rep</span>(<span class="st">"Private"</span>, <span class="fu">nrow</span>(private_valid))</span>
<span id="cb39-34"><a href="#cb39-34" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb39-35"><a href="#cb39-35" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-36"><a href="#cb39-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-37"><a href="#cb39-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate cross K function</span></span>
<span id="cb39-38"><a href="#cb39-38" aria-hidden="true" tabindex="-1"></a>    cross_k <span class="ot">&lt;-</span> <span class="fu">Kcross</span>(points_ppp, </span>
<span id="cb39-39"><a href="#cb39-39" aria-hidden="true" tabindex="-1"></a>                      <span class="at">i =</span> <span class="st">"Public"</span>, </span>
<span id="cb39-40"><a href="#cb39-40" aria-hidden="true" tabindex="-1"></a>                      <span class="at">j =</span> <span class="st">"Private"</span>,</span>
<span id="cb39-41"><a href="#cb39-41" aria-hidden="true" tabindex="-1"></a>                      <span class="at">correction =</span> <span class="st">"border"</span>)</span>
<span id="cb39-42"><a href="#cb39-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-43"><a href="#cb39-43" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Calculate theoretical envelope</span></span>
<span id="cb39-44"><a href="#cb39-44" aria-hidden="true" tabindex="-1"></a>    cross_k_env <span class="ot">&lt;-</span> <span class="fu">envelope</span>(points_ppp, </span>
<span id="cb39-45"><a href="#cb39-45" aria-hidden="true" tabindex="-1"></a>                           <span class="at">fun =</span> Kcross,</span>
<span id="cb39-46"><a href="#cb39-46" aria-hidden="true" tabindex="-1"></a>                           <span class="at">i =</span> <span class="st">"Public"</span>,</span>
<span id="cb39-47"><a href="#cb39-47" aria-hidden="true" tabindex="-1"></a>                           <span class="at">j =</span> <span class="st">"Private"</span>,</span>
<span id="cb39-48"><a href="#cb39-48" aria-hidden="true" tabindex="-1"></a>                           <span class="at">nsim =</span> <span class="dv">99</span>,</span>
<span id="cb39-49"><a href="#cb39-49" aria-hidden="true" tabindex="-1"></a>                           <span class="at">correction =</span> <span class="st">"border"</span>)</span>
<span id="cb39-50"><a href="#cb39-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb39-51"><a href="#cb39-51" aria-hidden="true" tabindex="-1"></a>    cross_k_status[[city]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb39-52"><a href="#cb39-52" aria-hidden="true" tabindex="-1"></a>      <span class="at">r =</span> cross_k<span class="sc">$</span>r,</span>
<span id="cb39-53"><a href="#cb39-53" aria-hidden="true" tabindex="-1"></a>      <span class="at">theo =</span> cross_k<span class="sc">$</span>theo,</span>
<span id="cb39-54"><a href="#cb39-54" aria-hidden="true" tabindex="-1"></a>      <span class="at">obs =</span> cross_k<span class="sc">$</span>border,</span>
<span id="cb39-55"><a href="#cb39-55" aria-hidden="true" tabindex="-1"></a>      <span class="at">env_lo =</span> cross_k_env<span class="sc">$</span>lo,</span>
<span id="cb39-56"><a href="#cb39-56" aria-hidden="true" tabindex="-1"></a>      <span class="at">env_hi =</span> cross_k_env<span class="sc">$</span>hi,</span>
<span id="cb39-57"><a href="#cb39-57" aria-hidden="true" tabindex="-1"></a>      <span class="at">city =</span> city</span>
<span id="cb39-58"><a href="#cb39-58" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb39-59"><a href="#cb39-59" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb39-60"><a href="#cb39-60" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: data contain duplicated points</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating 99 simulations of CSR  ...
1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 
99.

Done.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: data contain duplicated points</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating 99 simulations of CSR  ...
1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 
99.

Done.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: data contain duplicated points</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating 99 simulations of CSR  ...
1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 
99.

Done.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: data contain duplicated points</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating 99 simulations of CSR  ...
1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 
99.

Done.</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: data contain duplicated points</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Generating 99 simulations of CSR  ...
1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20,
21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40,
41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51, 52, 53, 54, 55, 56, 57, 58, 59, 60,
61, 62, 63, 64, 65, 66, 67, 68, 69, 70, 71, 72, 73, 74, 75, 76, 77, 78, 79, 80,
81, 82, 83, 84, 85, 86, 87, 88, 89, 90, 91, 92, 93, 94, 95, 96, 97, 98, 
99.

Done.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine results</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>cross_k_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(cross_k_status)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Create enhanced visualization</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cross_k_df) <span class="sc">+</span></span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add envelope</span></span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> r, <span class="at">ymin =</span> env_lo, <span class="at">ymax =</span> env_hi),</span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">"grey70"</span>, <span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add theoretical CSR line</span></span>
<span id="cb50-10"><a href="#cb50-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> r, <span class="at">y =</span> theo), </span>
<span id="cb50-11"><a href="#cb50-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb50-12"><a href="#cb50-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Add observed line</span></span>
<span id="cb50-13"><a href="#cb50-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> r, <span class="at">y =</span> obs, <span class="at">color =</span> city)) <span class="sc">+</span></span>
<span id="cb50-14"><a href="#cb50-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>city) <span class="sc">+</span></span>
<span id="cb50-15"><a href="#cb50-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb50-16"><a href="#cb50-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb50-17"><a href="#cb50-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb50-18"><a href="#cb50-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb50-19"><a href="#cb50-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb50-20"><a href="#cb50-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb50-21"><a href="#cb50-21" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb50-22"><a href="#cb50-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb50-23"><a href="#cb50-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cross K Function: Public vs Private School Interaction"</span>,</span>
<span id="cb50-24"><a href="#cb50-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Grey band: 95% confidence envelope, Red line: theoretical CSR"</span>,</span>
<span id="cb50-25"><a href="#cb50-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Distance (r)"</span>,</span>
<span id="cb50-26"><a href="#cb50-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"K(r)"</span>,</span>
<span id="cb50-27"><a href="#cb50-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"City"</span></span>
<span id="cb50-28"><a href="#cb50-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong></p>
<ul>
<li><strong>Jakarta Barat</strong>: Closest alignment to CSR, minimal deviation from theoretical line. Balanced distribution between public and private schools.</li>
<li><strong>Jakarta Pusat</strong>: Moderate deviation above CSR line, consistent clustering pattern across distances. Tighter confidence envelope at shorter distances. There is presence of planned co-location of public and private schools.</li>
<li><strong>Jakarta Selatan</strong>: Gradual increase in deviation with distance, systematic clustering at neighborhood line.</li>
<li><strong>Jakarta Timur</strong>: Strongest deviation above CSR, wide confidence envelope at larger distances. Indicates significant clustering of public and private schools</li>
<li><strong>Jakarta Utara</strong>: Most pronounced deviation from CSR, steepest curve especially at larger distances. Strong clustering pattern suggests potential access inequality issues.</li>
</ul>
<p><strong>Interaction Strength Metrics</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate interaction strength metrics</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>interaction_metrics <span class="ot">&lt;-</span> cross_k_df <span class="sc">%&gt;%</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(city) <span class="sc">%&gt;%</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_deviation =</span> <span class="fu">mean</span>(obs <span class="sc">-</span> theo),</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_deviation =</span> <span class="fu">max</span>(obs <span class="sc">-</span> theo),</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_distance =</span> <span class="fu">first</span>(r[<span class="fu">which.min</span>(<span class="fu">abs</span>(obs <span class="sc">-</span> theo))]),</span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">envelope_exceed =</span> <span class="fu">mean</span>(obs <span class="sc">&gt;</span> env_hi),</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb51-10"><a href="#cb51-10" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb51-11"><a href="#cb51-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-12"><a href="#cb51-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(interaction_metrics) <span class="sc">+</span></span>
<span id="cb51-13"><a href="#cb51-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(city, mean_deviation), </span>
<span id="cb51-14"><a href="#cb51-14" aria-hidden="true" tabindex="-1"></a>               <span class="at">y =</span> mean_deviation,</span>
<span id="cb51-15"><a href="#cb51-15" aria-hidden="true" tabindex="-1"></a>               <span class="at">fill =</span> mean_deviation),</span>
<span id="cb51-16"><a href="#cb51-16" aria-hidden="true" tabindex="-1"></a>           <span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb51-17"><a href="#cb51-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb51-18"><a href="#cb51-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb51-19"><a href="#cb51-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb51-20"><a href="#cb51-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb51-21"><a href="#cb51-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb51-22"><a href="#cb51-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb51-23"><a href="#cb51-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb51-24"><a href="#cb51-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb51-25"><a href="#cb51-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb51-26"><a href="#cb51-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Mean Deviation from CSR by City"</span>,</span>
<span id="cb51-27"><a href="#cb51-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Positive values indicate clustering between public and private schools"</span>,</span>
<span id="cb51-28"><a href="#cb51-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"City"</span>,</span>
<span id="cb51-29"><a href="#cb51-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Mean Deviation from CSR"</span></span>
<span id="cb51-30"><a href="#cb51-30" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>School Level Interactions by City</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enhanced Cross K Function Analysis with Jitter</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>cross_k_by_level <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>({</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(city <span class="cf">in</span> <span class="fu">unique</span>(jakarta_schools_utm<span class="sc">$</span>city_name)) {</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  city_schools <span class="ot">&lt;-</span> jakarta_schools_utm[jakarta_schools_utm<span class="sc">$</span>city_name <span class="sc">==</span> city,]</span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a>  city_boundary <span class="ot">&lt;-</span> adm2_utm[adm2_utm<span class="sc">$</span>shapeName <span class="sc">==</span> city,]</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>  city_window <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(<span class="fu">st_union</span>(city_boundary))</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>  school_levels <span class="ot">&lt;-</span> <span class="fu">unique</span>(city_schools<span class="sc">$</span>school_level)</span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(level1 <span class="cf">in</span> school_levels) {</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span>(level2 <span class="cf">in</span> school_levels) {</span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(level1 <span class="sc">&lt;</span> level2) {  <span class="co"># Avoid redundant comparisons</span></span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>        schools1 <span class="ot">&lt;-</span> city_schools[city_schools<span class="sc">$</span>school_level <span class="sc">==</span> level1,]</span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>        schools2 <span class="ot">&lt;-</span> city_schools[city_schools<span class="sc">$</span>school_level <span class="sc">==</span> level2,]</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb52-17"><a href="#cb52-17" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Add jitter to coordinates</span></span>
<span id="cb52-18"><a href="#cb52-18" aria-hidden="true" tabindex="-1"></a>        coords1 <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(schools1)</span>
<span id="cb52-19"><a href="#cb52-19" aria-hidden="true" tabindex="-1"></a>        coords2 <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(schools2)</span>
<span id="cb52-20"><a href="#cb52-20" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb52-21"><a href="#cb52-21" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Filter points within window</span></span>
<span id="cb52-22"><a href="#cb52-22" aria-hidden="true" tabindex="-1"></a>        inside1 <span class="ot">&lt;-</span> <span class="fu">inside.owin</span>(<span class="at">x =</span> coords1[,<span class="dv">1</span>], <span class="at">y =</span> coords1[,<span class="dv">2</span>], <span class="at">w =</span> city_window)</span>
<span id="cb52-23"><a href="#cb52-23" aria-hidden="true" tabindex="-1"></a>        inside2 <span class="ot">&lt;-</span> <span class="fu">inside.owin</span>(<span class="at">x =</span> coords2[,<span class="dv">1</span>], <span class="at">y =</span> coords2[,<span class="dv">2</span>], <span class="at">w =</span> city_window)</span>
<span id="cb52-24"><a href="#cb52-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb52-25"><a href="#cb52-25" aria-hidden="true" tabindex="-1"></a>        valid1 <span class="ot">&lt;-</span> coords1[inside1,]</span>
<span id="cb52-26"><a href="#cb52-26" aria-hidden="true" tabindex="-1"></a>        valid2 <span class="ot">&lt;-</span> coords2[inside2,]</span>
<span id="cb52-27"><a href="#cb52-27" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb52-28"><a href="#cb52-28" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Create point pattern only if we have valid points</span></span>
<span id="cb52-29"><a href="#cb52-29" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span>(<span class="fu">nrow</span>(valid1) <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> <span class="fu">nrow</span>(valid2) <span class="sc">&gt;</span> <span class="dv">0</span>) {</span>
<span id="cb52-30"><a href="#cb52-30" aria-hidden="true" tabindex="-1"></a>          points_ppp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(</span>
<span id="cb52-31"><a href="#cb52-31" aria-hidden="true" tabindex="-1"></a>            <span class="at">x =</span> <span class="fu">c</span>(valid1[,<span class="dv">1</span>], valid2[,<span class="dv">1</span>]),</span>
<span id="cb52-32"><a href="#cb52-32" aria-hidden="true" tabindex="-1"></a>            <span class="at">y =</span> <span class="fu">c</span>(valid1[,<span class="dv">2</span>], valid2[,<span class="dv">2</span>]),</span>
<span id="cb52-33"><a href="#cb52-33" aria-hidden="true" tabindex="-1"></a>            <span class="at">window =</span> city_window,</span>
<span id="cb52-34"><a href="#cb52-34" aria-hidden="true" tabindex="-1"></a>            <span class="at">marks =</span> <span class="fu">factor</span>(<span class="fu">c</span>(</span>
<span id="cb52-35"><a href="#cb52-35" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rep</span>(level1, <span class="fu">nrow</span>(valid1)),</span>
<span id="cb52-36"><a href="#cb52-36" aria-hidden="true" tabindex="-1"></a>              <span class="fu">rep</span>(level2, <span class="fu">nrow</span>(valid2))</span>
<span id="cb52-37"><a href="#cb52-37" aria-hidden="true" tabindex="-1"></a>            ))</span>
<span id="cb52-38"><a href="#cb52-38" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb52-39"><a href="#cb52-39" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb52-40"><a href="#cb52-40" aria-hidden="true" tabindex="-1"></a>          <span class="co"># Calculate cross K function</span></span>
<span id="cb52-41"><a href="#cb52-41" aria-hidden="true" tabindex="-1"></a>          cross_k <span class="ot">&lt;-</span> <span class="fu">Kcross</span>(points_ppp, <span class="at">i =</span> level1, <span class="at">j =</span> level2, <span class="at">correction =</span> <span class="st">"border"</span>)</span>
<span id="cb52-42"><a href="#cb52-42" aria-hidden="true" tabindex="-1"></a>          </span>
<span id="cb52-43"><a href="#cb52-43" aria-hidden="true" tabindex="-1"></a>          cross_k_by_level[[<span class="fu">paste</span>(city, level1, level2, <span class="at">sep=</span><span class="st">"_"</span>)]] <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb52-44"><a href="#cb52-44" aria-hidden="true" tabindex="-1"></a>            <span class="at">r =</span> cross_k<span class="sc">$</span>r,</span>
<span id="cb52-45"><a href="#cb52-45" aria-hidden="true" tabindex="-1"></a>            <span class="at">theo =</span> cross_k<span class="sc">$</span>theo,</span>
<span id="cb52-46"><a href="#cb52-46" aria-hidden="true" tabindex="-1"></a>            <span class="at">obs =</span> cross_k<span class="sc">$</span>border,</span>
<span id="cb52-47"><a href="#cb52-47" aria-hidden="true" tabindex="-1"></a>            <span class="at">city =</span> city,</span>
<span id="cb52-48"><a href="#cb52-48" aria-hidden="true" tabindex="-1"></a>            <span class="at">level1 =</span> level1,</span>
<span id="cb52-49"><a href="#cb52-49" aria-hidden="true" tabindex="-1"></a>            <span class="at">level2 =</span> level2</span>
<span id="cb52-50"><a href="#cb52-50" aria-hidden="true" tabindex="-1"></a>          )</span>
<span id="cb52-51"><a href="#cb52-51" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb52-52"><a href="#cb52-52" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb52-53"><a href="#cb52-53" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb52-54"><a href="#cb52-54" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb52-55"><a href="#cb52-55" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb52-56"><a href="#cb52-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-57"><a href="#cb52-57" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine results</span></span>
<span id="cb52-58"><a href="#cb52-58" aria-hidden="true" tabindex="-1"></a>  cross_k_df <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(cross_k_by_level)</span>
<span id="cb52-59"><a href="#cb52-59" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb52-60"><a href="#cb52-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-61"><a href="#cb52-61" aria-hidden="true" tabindex="-1"></a><span class="co"># Create visualization</span></span>
<span id="cb52-62"><a href="#cb52-62" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(cross_k_df) <span class="sc">+</span></span>
<span id="cb52-63"><a href="#cb52-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> r, <span class="at">y =</span> theo), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb52-64"><a href="#cb52-64" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> r, <span class="at">y =</span> obs, <span class="at">color =</span> <span class="fu">paste</span>(level1, <span class="st">"-"</span>, level2))) <span class="sc">+</span></span>
<span id="cb52-65"><a href="#cb52-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>city, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb52-66"><a href="#cb52-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb52-67"><a href="#cb52-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb52-68"><a href="#cb52-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb52-69"><a href="#cb52-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb52-70"><a href="#cb52-70" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb52-71"><a href="#cb52-71" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb52-72"><a href="#cb52-72" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb52-73"><a href="#cb52-73" aria-hidden="true" tabindex="-1"></a>    <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb52-74"><a href="#cb52-74" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb52-75"><a href="#cb52-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb52-76"><a href="#cb52-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Cross K Function Analysis: School Level Interactions by City"</span>,</span>
<span id="cb52-77"><a href="#cb52-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Red dashed line: theoretical CSR"</span>,</span>
<span id="cb52-78"><a href="#cb52-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Distance (r)"</span>,</span>
<span id="cb52-79"><a href="#cb52-79" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"K(r)"</span>,</span>
<span id="cb52-80"><a href="#cb52-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"School Level Pair"</span></span>
<span id="cb52-81"><a href="#cb52-81" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb52-82"><a href="#cb52-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">nrow =</span> <span class="dv">2</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong></p>
<ul>
<li>Elementary-Junior High: Strongest clustering in all cities. Consistent with educational progression planning. This means that elementary and junior high schools are often co-located. Above CSR line across all distances.</li>
<li>Elementary-Senior High: More varied patterns across cities. Jakarta Timur shows strongest clustering. Jakarta Barat shows more random distribution.</li>
<li>Special Education: Most variable patterns, strongest clustering in Jakarta Utara, weakest clustering in Jakarta Barat.</li>
</ul>
<p><strong>Level Pairs by City</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create separate plots for each school level pair</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>level_pairs <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">paste</span>(cross_k_df<span class="sc">$</span>level1, <span class="st">"-"</span>, cross_k_df<span class="sc">$</span>level2))</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(pair <span class="cf">in</span> level_pairs) {</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  pair_data <span class="ot">&lt;-</span> cross_k_df <span class="sc">%&gt;%</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="fu">paste</span>(level1, <span class="st">"-"</span>, level2) <span class="sc">==</span> pair)</span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>  p <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(pair_data) <span class="sc">+</span></span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> r, <span class="at">y =</span> theo), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> r, <span class="at">y =</span> obs, <span class="at">color =</span> city)) <span class="sc">+</span></span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>city, <span class="at">scales =</span> <span class="st">"free"</span>) <span class="sc">+</span></span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"bottom"</span>,</span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a>      <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"Cross K Function Analysis:"</span>, pair),</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">subtitle =</span> <span class="st">"Red dashed line: theoretical CSR"</span>,</span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">"Distance (r)"</span>,</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> <span class="st">"K(r)"</span>,</span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a>      <span class="at">color =</span> <span class="st">"City"</span></span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(p)</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-31-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-31-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-31-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-31-5.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-31-6.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Summary Statistics</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate summary statistics</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>summary_stats <span class="ot">&lt;-</span> cross_k_df <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(city, level1, level2) <span class="sc">%&gt;%</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">mean_deviation =</span> <span class="fu">mean</span>(obs <span class="sc">-</span> theo),</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_deviation =</span> <span class="fu">max</span>(obs <span class="sc">-</span> theo),</span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_distance =</span> <span class="fu">first</span>(r[<span class="fu">which.min</span>(<span class="fu">abs</span>(obs <span class="sc">-</span> theo))]),</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span></span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Create summary visualization</span></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(summary_stats, </span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(<span class="fu">paste</span>(level1, <span class="st">"-"</span>, level2), mean_deviation), </span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>           <span class="at">y =</span> mean_deviation, </span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>           <span class="at">fill =</span> city)) <span class="sc">+</span></span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>, <span class="at">face =</span> <span class="st">"bold"</span>)</span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Mean Deviation from CSR by School Level Pair and City"</span>,</span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"School Level Pair"</span>,</span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Mean Deviation from CSR"</span>,</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"City"</span></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong>:</p>
<ul>
<li>Elementary-Special Education: Highest deviation in Jakarta Utara, negative deviations in western cities. Possibly due to accessibilty challenges.</li>
<li>Junior High-Special Education: Strong clustering in eastern regions. Infrastructure implications for accessibility.</li>
<li>Elementary-Senior High: More balanced deviation, positive deviations in all eastern cities. Supports educational progression planning.</li>
</ul>
</section>
<section id="k-function-and-l-function-analysis" class="level3">
<h3 class="anchored" data-anchor-id="k-function-and-l-function-analysis">5.5 K Function and L Function Analysis</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>k_l_analysis <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(city <span class="cf">in</span> <span class="fu">unique</span>(jakarta_schools_utm<span class="sc">$</span>city_name)) {</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  city_schools <span class="ot">&lt;-</span> jakarta_schools_utm[jakarta_schools_utm<span class="sc">$</span>city_name <span class="sc">==</span> city,]</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  city_boundary <span class="ot">&lt;-</span> adm2_utm[adm2_utm<span class="sc">$</span>shapeName <span class="sc">==</span> city,]</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Create window and points</span></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>  city_window <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(<span class="fu">st_union</span>(city_boundary))</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>  jittered_result <span class="ot">&lt;-</span> <span class="fu">proper_jitter</span>(city_schools, city_window)</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>  points_ppp <span class="ot">&lt;-</span> jittered_result<span class="sc">$</span>points_ppp</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate K and L functions</span></span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a>  k_func <span class="ot">&lt;-</span> <span class="fu">Kest</span>(points_ppp, <span class="at">correction =</span> <span class="st">"border"</span>)</span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a>  l_func <span class="ot">&lt;-</span> <span class="fu">Lest</span>(points_ppp, <span class="at">correction =</span> <span class="st">"border"</span>)</span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>  k_l_analysis[[city]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">k =</span> k_func,</span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">l =</span> l_func</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot K function</span></span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>k_plot_data <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(k_l_analysis), <span class="cf">function</span>(city) {</span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">r =</span> k_l_analysis[[city]]<span class="sc">$</span>k<span class="sc">$</span>r,</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">theo =</span> k_l_analysis[[city]]<span class="sc">$</span>k<span class="sc">$</span>theo,</span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">obs =</span> k_l_analysis[[city]]<span class="sc">$</span>k<span class="sc">$</span>border,</span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">city =</span> city</span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>()</span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a>p_k <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(k_plot_data) <span class="sc">+</span></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> r, <span class="at">y =</span> theo), <span class="at">color =</span> <span class="st">"red"</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>) <span class="sc">+</span></span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> r, <span class="at">y =</span> obs, <span class="at">color =</span> city)) <span class="sc">+</span></span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>city) <span class="sc">+</span></span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Ripley's K Function by City"</span>,</span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Red dashed line: theoretical CSR"</span>,</span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Distance (r)"</span>,</span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"K(r)"</span></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a><span class="co"># Plot L function</span></span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a>l_plot_data <span class="ot">&lt;-</span> <span class="fu">lapply</span>(<span class="fu">names</span>(k_l_analysis), <span class="cf">function</span>(city) {</span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>    <span class="at">r =</span> k_l_analysis[[city]]<span class="sc">$</span>l<span class="sc">$</span>r,</span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a>    <span class="at">theo =</span> k_l_analysis[[city]]<span class="sc">$</span>l<span class="sc">$</span>theo,</span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>    <span class="at">obs =</span> k_l_analysis[[city]]<span class="sc">$</span>l<span class="sc">$</span>border <span class="sc">-</span> k_l_analysis[[city]]<span class="sc">$</span>l<span class="sc">$</span>r,</span>
<span id="cb55-51"><a href="#cb55-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">city =</span> city</span>
<span id="cb55-52"><a href="#cb55-52" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb55-53"><a href="#cb55-53" aria-hidden="true" tabindex="-1"></a>}) <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>()</span>
<span id="cb55-54"><a href="#cb55-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-55"><a href="#cb55-55" aria-hidden="true" tabindex="-1"></a>p_l <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(l_plot_data) <span class="sc">+</span></span>
<span id="cb55-56"><a href="#cb55-56" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype =</span> <span class="st">"dashed"</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb55-57"><a href="#cb55-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> r, <span class="at">y =</span> obs, <span class="at">color =</span> city)) <span class="sc">+</span></span>
<span id="cb55-58"><a href="#cb55-58" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>city) <span class="sc">+</span></span>
<span id="cb55-59"><a href="#cb55-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb55-60"><a href="#cb55-60" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb55-61"><a href="#cb55-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb55-62"><a href="#cb55-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"L Function by City"</span>,</span>
<span id="cb55-63"><a href="#cb55-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"L(r) - r, positive values indicate clustering"</span>,</span>
<span id="cb55-64"><a href="#cb55-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Distance (r)"</span>,</span>
<span id="cb55-65"><a href="#cb55-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"L(r) - r"</span></span>
<span id="cb55-66"><a href="#cb55-66" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>p_k</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong>:</p>
<ul>
<li>All cities show positive deviation from CSR indicating non-random spatial clustering of schools.</li>
<li>The deviation magnitude varies significantly, showing different planning approaches across Jakarta.</li>
<li>The steepness of curves increases with distance, suggesting neighborhood-level educational clusters.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>p_l</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-35-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong>:</p>
<ul>
<li>Intensity of clustering varies dramatically between North and West</li>
<li>Central regions show moderate, consistent clustering</li>
<li>Distance appears to amplify clustering patterns, particularly in northern regions</li>
</ul>
</section>
</section>
<section id="kernel-density-estimation-city-level" class="level2">
<h2 class="anchored" data-anchor-id="kernel-density-estimation-city-level">6.0 Kernel Density Estimation (City Level)</h2>
<p>To further understand school distribution patterns, we will conduct a Kernel Density Estimation (KDE) analysis at the city level. By examining the density of school locations, we can identify hotspots, assess clustering patterns, and evaluate spatial relationships between schools.</p>
<section id="kde-analysis" class="level3">
<h3 class="anchored" data-anchor-id="kde-analysis">6.1 KDE Analysis</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="co"># KDE Analysis by City</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>kde_city_level <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(city <span class="cf">in</span> <span class="fu">unique</span>(jakarta_schools_utm<span class="sc">$</span>city_name)) {</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>  city_schools <span class="ot">&lt;-</span> jakarta_schools_utm[jakarta_schools_utm<span class="sc">$</span>city_name <span class="sc">==</span> city,]</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>  city_boundary <span class="ot">&lt;-</span> adm2_utm[adm2_utm<span class="sc">$</span>shapeName <span class="sc">==</span> city,]</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>  city_window <span class="ot">&lt;-</span> <span class="fu">as.owin</span>(<span class="fu">st_union</span>(city_boundary))</span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a>  kde_city_level[[city]] <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb58-10"><a href="#cb58-10" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-11"><a href="#cb58-11" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Process all schools in city</span></span>
<span id="cb58-12"><a href="#cb58-12" aria-hidden="true" tabindex="-1"></a>  jittered_schools <span class="ot">&lt;-</span> <span class="fu">st_jitter</span>(city_schools, <span class="at">amount =</span> <span class="dv">1</span>)</span>
<span id="cb58-13"><a href="#cb58-13" aria-hidden="true" tabindex="-1"></a>  coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(jittered_schools)</span>
<span id="cb58-14"><a href="#cb58-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-15"><a href="#cb58-15" aria-hidden="true" tabindex="-1"></a>  inside <span class="ot">&lt;-</span> <span class="fu">inside.owin</span>(<span class="at">x =</span> coords[,<span class="dv">1</span>], <span class="at">y =</span> coords[,<span class="dv">2</span>], <span class="at">w =</span> city_window)</span>
<span id="cb58-16"><a href="#cb58-16" aria-hidden="true" tabindex="-1"></a>  valid_coords <span class="ot">&lt;-</span> coords[inside,]</span>
<span id="cb58-17"><a href="#cb58-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-18"><a href="#cb58-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">nrow</span>(valid_coords) <span class="sc">&gt;=</span> <span class="dv">4</span>) {</span>
<span id="cb58-19"><a href="#cb58-19" aria-hidden="true" tabindex="-1"></a>    points_ppp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(</span>
<span id="cb58-20"><a href="#cb58-20" aria-hidden="true" tabindex="-1"></a>      <span class="at">x =</span> valid_coords[,<span class="dv">1</span>],</span>
<span id="cb58-21"><a href="#cb58-21" aria-hidden="true" tabindex="-1"></a>      <span class="at">y =</span> valid_coords[,<span class="dv">2</span>],</span>
<span id="cb58-22"><a href="#cb58-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">window =</span> city_window</span>
<span id="cb58-23"><a href="#cb58-23" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb58-24"><a href="#cb58-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-25"><a href="#cb58-25" aria-hidden="true" tabindex="-1"></a>    h <span class="ot">&lt;-</span> <span class="fu">bw.scott</span>(points_ppp)</span>
<span id="cb58-26"><a href="#cb58-26" aria-hidden="true" tabindex="-1"></a>    kde <span class="ot">&lt;-</span> <span class="fu">density.ppp</span>(points_ppp, </span>
<span id="cb58-27"><a href="#cb58-27" aria-hidden="true" tabindex="-1"></a>                      <span class="at">sigma =</span> h,</span>
<span id="cb58-28"><a href="#cb58-28" aria-hidden="true" tabindex="-1"></a>                      <span class="at">edge =</span> <span class="cn">TRUE</span>,</span>
<span id="cb58-29"><a href="#cb58-29" aria-hidden="true" tabindex="-1"></a>                      <span class="at">at =</span> <span class="st">"pixels"</span>,</span>
<span id="cb58-30"><a href="#cb58-30" aria-hidden="true" tabindex="-1"></a>                      <span class="at">dimyx =</span> <span class="fu">c</span>(<span class="dv">128</span>, <span class="dv">128</span>))</span>
<span id="cb58-31"><a href="#cb58-31" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-32"><a href="#cb58-32" aria-hidden="true" tabindex="-1"></a>    kde_city_level[[city]][[<span class="st">"All"</span>]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb58-33"><a href="#cb58-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">kde =</span> kde,</span>
<span id="cb58-34"><a href="#cb58-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">n_points =</span> <span class="fu">nrow</span>(valid_coords),</span>
<span id="cb58-35"><a href="#cb58-35" aria-hidden="true" tabindex="-1"></a>      <span class="at">bandwidth =</span> h</span>
<span id="cb58-36"><a href="#cb58-36" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb58-37"><a href="#cb58-37" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb58-38"><a href="#cb58-38" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb58-39"><a href="#cb58-39" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(level <span class="cf">in</span> <span class="fu">unique</span>(city_schools<span class="sc">$</span>school_level)) {</span>
<span id="cb58-40"><a href="#cb58-40" aria-hidden="true" tabindex="-1"></a>    level_schools <span class="ot">&lt;-</span> city_schools[city_schools<span class="sc">$</span>school_level <span class="sc">==</span> level,]</span>
<span id="cb58-41"><a href="#cb58-41" aria-hidden="true" tabindex="-1"></a>    jittered_level <span class="ot">&lt;-</span> <span class="fu">st_jitter</span>(level_schools, <span class="at">amount =</span> <span class="dv">1</span>)</span>
<span id="cb58-42"><a href="#cb58-42" aria-hidden="true" tabindex="-1"></a>    level_coords <span class="ot">&lt;-</span> <span class="fu">st_coordinates</span>(jittered_level)</span>
<span id="cb58-43"><a href="#cb58-43" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-44"><a href="#cb58-44" aria-hidden="true" tabindex="-1"></a>    inside <span class="ot">&lt;-</span> <span class="fu">inside.owin</span>(<span class="at">x =</span> level_coords[,<span class="dv">1</span>],</span>
<span id="cb58-45"><a href="#cb58-45" aria-hidden="true" tabindex="-1"></a>                         <span class="at">y =</span> level_coords[,<span class="dv">2</span>],</span>
<span id="cb58-46"><a href="#cb58-46" aria-hidden="true" tabindex="-1"></a>                         <span class="at">w =</span> city_window)</span>
<span id="cb58-47"><a href="#cb58-47" aria-hidden="true" tabindex="-1"></a>    valid_coords <span class="ot">&lt;-</span> level_coords[inside,]</span>
<span id="cb58-48"><a href="#cb58-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb58-49"><a href="#cb58-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">nrow</span>(valid_coords) <span class="sc">&gt;=</span> <span class="dv">4</span>) {</span>
<span id="cb58-50"><a href="#cb58-50" aria-hidden="true" tabindex="-1"></a>      points_ppp <span class="ot">&lt;-</span> <span class="fu">ppp</span>(</span>
<span id="cb58-51"><a href="#cb58-51" aria-hidden="true" tabindex="-1"></a>        <span class="at">x =</span> valid_coords[,<span class="dv">1</span>],</span>
<span id="cb58-52"><a href="#cb58-52" aria-hidden="true" tabindex="-1"></a>        <span class="at">y =</span> valid_coords[,<span class="dv">2</span>],</span>
<span id="cb58-53"><a href="#cb58-53" aria-hidden="true" tabindex="-1"></a>        <span class="at">window =</span> city_window</span>
<span id="cb58-54"><a href="#cb58-54" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb58-55"><a href="#cb58-55" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb58-56"><a href="#cb58-56" aria-hidden="true" tabindex="-1"></a>      h <span class="ot">&lt;-</span> <span class="fu">bw.scott</span>(points_ppp)</span>
<span id="cb58-57"><a href="#cb58-57" aria-hidden="true" tabindex="-1"></a>      kde <span class="ot">&lt;-</span> <span class="fu">density.ppp</span>(points_ppp, </span>
<span id="cb58-58"><a href="#cb58-58" aria-hidden="true" tabindex="-1"></a>                        <span class="at">sigma =</span> h,</span>
<span id="cb58-59"><a href="#cb58-59" aria-hidden="true" tabindex="-1"></a>                        <span class="at">edge =</span> <span class="cn">TRUE</span>,</span>
<span id="cb58-60"><a href="#cb58-60" aria-hidden="true" tabindex="-1"></a>                        <span class="at">at =</span> <span class="st">"pixels"</span>,</span>
<span id="cb58-61"><a href="#cb58-61" aria-hidden="true" tabindex="-1"></a>                        <span class="at">dimyx =</span> <span class="fu">c</span>(<span class="dv">128</span>, <span class="dv">128</span>))</span>
<span id="cb58-62"><a href="#cb58-62" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb58-63"><a href="#cb58-63" aria-hidden="true" tabindex="-1"></a>      kde_city_level[[city]][[level]] <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb58-64"><a href="#cb58-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">kde =</span> kde,</span>
<span id="cb58-65"><a href="#cb58-65" aria-hidden="true" tabindex="-1"></a>        <span class="at">n_points =</span> <span class="fu">nrow</span>(valid_coords),</span>
<span id="cb58-66"><a href="#cb58-66" aria-hidden="true" tabindex="-1"></a>        <span class="at">bandwidth =</span> h</span>
<span id="cb58-67"><a href="#cb58-67" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb58-68"><a href="#cb58-68" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb58-69"><a href="#cb58-69" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb58-70"><a href="#cb58-70" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>city_plots <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(city <span class="cf">in</span> <span class="fu">names</span>(kde_city_level)) {</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>  plot_list <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>  city_boundary <span class="ot">&lt;-</span> adm2_utm[adm2_utm<span class="sc">$</span>shapeName <span class="sc">==</span> city,]</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>  kde_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(kde_city_level[[city]][[<span class="st">"All"</span>]]<span class="sc">$</span>kde)</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>  plot_list[[<span class="st">"All"</span>]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_tile</span>(<span class="at">data =</span> kde_df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> city_boundary, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>, <span class="at">name =</span> <span class="st">"Density"</span>) <span class="sc">+</span></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">"right"</span></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"All Schools"</span>)</span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>  legend <span class="ot">&lt;-</span> <span class="fu">get_legend</span>(plot_list[[<span class="st">"All"</span>]])</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(level <span class="cf">in</span> <span class="fu">setdiff</span>(<span class="fu">names</span>(kde_city_level[[city]]), <span class="st">"All"</span>)) {</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a>    kde_df <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(kde_city_level[[city]][[level]]<span class="sc">$</span>kde)</span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a>    plot_list[[level]] <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_tile</span>(<span class="at">data =</span> kde_df, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> value)) <span class="sc">+</span></span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">geom_sf</span>(<span class="at">data =</span> city_boundary, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">"white"</span>, <span class="at">size =</span> <span class="fl">0.4</span>) <span class="sc">+</span></span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">theme</span>(</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a>        <span class="at">legend.position =</span> <span class="st">"none"</span></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a>      <span class="fu">labs</span>(<span class="at">title =</span> level)</span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>  combined_plots <span class="ot">&lt;-</span> <span class="fu">wrap_plots</span>(</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a>    plot_list,</span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a>    <span class="at">ncol =</span> <span class="dv">3</span>,</span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>    <span class="at">guides =</span> <span class="st">"collect"</span></span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plot_annotation</span>(</span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">"School Density Analysis -"</span>, city),</span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a>      <span class="at">theme =</span> <span class="fu">theme</span>(</span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>        <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">"bold"</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>)</span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a>  city_plots[[city]] <span class="ot">&lt;-</span> combined_plots</span>
<span id="cb59-50"><a href="#cb59-50" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb59-51"><a href="#cb59-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-52"><a href="#cb59-52" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(city <span class="cf">in</span> <span class="fu">names</span>(city_plots)) {</span>
<span id="cb59-53"><a href="#cb59-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggsave</span>(</span>
<span id="cb59-54"><a href="#cb59-54" aria-hidden="true" tabindex="-1"></a>    <span class="at">filename =</span> <span class="fu">paste0</span>(<span class="st">"kde_"</span>, <span class="fu">gsub</span>(<span class="st">" "</span>, <span class="st">"_"</span>, city), <span class="st">".png"</span>),</span>
<span id="cb59-55"><a href="#cb59-55" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot =</span> city_plots[[city]],</span>
<span id="cb59-56"><a href="#cb59-56" aria-hidden="true" tabindex="-1"></a>    <span class="at">width =</span> <span class="dv">15</span>,</span>
<span id="cb59-57"><a href="#cb59-57" aria-hidden="true" tabindex="-1"></a>    <span class="at">height =</span> <span class="dv">12</span>,</span>
<span id="cb59-58"><a href="#cb59-58" aria-hidden="true" tabindex="-1"></a>    <span class="at">dpi =</span> <span class="dv">300</span></span>
<span id="cb59-59"><a href="#cb59-59" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb59-60"><a href="#cb59-60" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><img src="kde_Kota_Jakarta_Utara.png" class="img-fluid"></p>
<p><img src="kde_Kota_Jakarta_Selatan.png" class="img-fluid"></p>
<p><img src="kde_Kota_Jakarta_Timur.png" class="img-fluid"></p>
<p><img src="kde_Kota_Jakarta_Barat.png" class="img-fluid"></p>
<p><img src="kde_Kota_Jakarta_Pusat.png" class="img-fluid"></p>
<p><strong>Elementary Schools</strong></p>
<ul>
<li>Consistent Core Distribution:
<ul>
<li>Forms the backbone of educational infrastructure in all cities</li>
<li>Highest density clusters align with residential areas</li>
<li>More evenly distributed compared to other school types</li>
<li>Strongest presence in eastern districts of Jakarta Pusat and western areas of Jakarta Timur</li>
</ul></li>
<li>Edge Effects:
<ul>
<li>Lower density at city boundaries suggests potential cross-border dependencies</li>
<li>Some peripheral areas show coverage gaps</li>
<li>Notable boundary clustering between Jakarta Pusat and Jakarta Timur</li>
</ul></li>
</ul>
<p><strong>Junior High Schools</strong></p>
<ul>
<li>Clustering Patterns:
<ul>
<li>Strong correlation with elementary school locations</li>
<li>More concentrated distribution than elementary schools</li>
<li>Clear hotspots in commercial/residential transition zones</li>
<li>Notable concentration along major transportation corridors</li>
</ul></li>
</ul>
<p><strong>Senior High Schools</strong>:</p>
<ul>
<li>Strategic Positioning:
<ul>
<li>Concentrated in accessible, central locations</li>
<li>Strong alignment with commercial districts</li>
<li>Clear clustering near transportation hubs</li>
<li>Higher density in areas with good connectivity</li>
</ul></li>
<li>Coverage Patterns:
<ul>
<li>More selective location strategy than lower levels</li>
<li>Forms distinct educational nodes</li>
<li>Higher concentration in developed urban areas</li>
<li>Shows gaps in peripheral regions</li>
</ul></li>
</ul>
<p><strong>Special Education</strong>:</p>
<ul>
<li>Critical Findings
<ul>
<li>Severely limited distribution across all cities</li>
<li>Most concentrated in Jakarta Pusat and Jakarta Selatan</li>
<li>Significant coverage gaps in peripheral areas</li>
<li>Lowest density among all school types</li>
</ul></li>
<li>Access Concerns
<ul>
<li>Limited accessibility from residential areas</li>
<li>Uneven distribution creates service gaps</li>
<li>Concentration in affluent areas suggests inequality</li>
</ul></li>
</ul>
</section>
<section id="relative-density-metrics" class="level3">
<h3 class="anchored" data-anchor-id="relative-density-metrics">6.2 Relative Density Metrics</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate relative densities for each city</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>density_metrics <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">city =</span> <span class="fu">character</span>(),</span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">level =</span> <span class="fu">character</span>(),</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">max_density =</span> <span class="fu">numeric</span>(),</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">mean_density =</span> <span class="fu">numeric</span>(),</span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">relative_density =</span> <span class="fu">numeric</span>(),</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(city <span class="cf">in</span> <span class="fu">names</span>(kde_city_level)) {</span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>  city_max <span class="ot">&lt;-</span> <span class="fu">max</span>(kde_city_level[[city]][[<span class="st">"All"</span>]]<span class="sc">$</span>kde<span class="sc">$</span>v, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(level <span class="cf">in</span> <span class="fu">names</span>(kde_city_level[[city]])) {</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(level <span class="sc">!=</span> <span class="st">"All"</span>) {</span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>      kde_data <span class="ot">&lt;-</span> kde_city_level[[city]][[level]]</span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a>      density_metrics <span class="ot">&lt;-</span> <span class="fu">rbind</span>(density_metrics, <span class="fu">data.frame</span>(</span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">city =</span> city,</span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a>        <span class="at">level =</span> level,</span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>        <span class="at">max_density =</span> <span class="fu">max</span>(kde_data<span class="sc">$</span>kde<span class="sc">$</span>v, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>        <span class="at">mean_density =</span> <span class="fu">mean</span>(kde_data<span class="sc">$</span>kde<span class="sc">$</span>v, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a>        <span class="at">relative_density =</span> <span class="fu">max</span>(kde_data<span class="sc">$</span>kde<span class="sc">$</span>v, <span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">/</span> city_max,</span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a>        <span class="at">stringsAsFactors =</span> <span class="cn">FALSE</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(density_metrics, </span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>                       <span class="fu">aes</span>(<span class="at">x =</span> level, <span class="at">y =</span> relative_density, <span class="at">fill =</span> city)) <span class="sc">+</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>, <span class="at">position =</span> <span class="st">"dodge"</span>) <span class="sc">+</span></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">"plasma"</span>) <span class="sc">+</span></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>),</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">"bold"</span>),</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">plot.margin =</span> <span class="fu">margin</span>(<span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>, <span class="dv">20</span>)</span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Relative Density of School Types by City"</span>,</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Maximum density relative to overall school density"</span>,</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"School Level"</span>,</span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Relative Density"</span>,</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">fill =</span> <span class="st">"City"</span></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="THE03C_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><strong>Key Observations</strong>:</p>
<ul>
<li>Elementary schools dominate the educational landscape (0.4 - 0.7 relative density)</li>
<li>Secondary schools show remarkably consistent density across cities</li>
<li>Special education facilities are significantly underrepresented across all cities</li>
</ul>
</section>
</section>
<section id="insights-and-recommendations" class="level2">
<h2 class="anchored" data-anchor-id="insights-and-recommendations">7.0 Insights and Recommendations</h2>
<section id="key-spatial-patterns" class="level3">
<h3 class="anchored" data-anchor-id="key-spatial-patterns">7.1 Key Spatial Patterns</h3>
<p><strong>Provincial Level</strong></p>
<ol type="1">
<li><strong>Clustering Intensity</strong></li>
</ol>
<ul>
<li>Strong clustering in central Jakarta</li>
<li>Moderate clustering in peripheral areas</li>
<li>Non-random distribution confirmed by chi-squared test</li>
</ul>
<ol start="2" type="1">
<li><strong>School Type Distribution</strong></li>
</ol>
<ul>
<li>Elementary schools show most even distribution</li>
<li>Secondary schools cluster near transportation nodes</li>
<li>Special education facilities show significant gaps</li>
</ul>
<ol start="3" type="1">
<li><strong>Population Alignment</strong></li>
</ol>
<ul>
<li>Strong correlation in established areas</li>
<li>Mismatches in rapidly developing areas</li>
<li>Northern coastal areas underserved</li>
</ul>
<p><strong>City Level</strong></p>
<ol type="1">
<li><strong>Jakarta Pusat</strong></li>
</ol>
<ul>
<li>Highest density, strong public-private integration</li>
</ul>
<ol start="2" type="1">
<li><strong>Jakarta Timur</strong></li>
</ol>
<ul>
<li>Most balanced distribution, strong correlation with population, effective public-private mix</li>
</ul>
<ol start="3" type="1">
<li><strong>Jakarta Barat</strong></li>
</ol>
<ul>
<li>Moderate clustering, north-south disparity, transportation corridor alignment</li>
</ul>
<ol start="4" type="1">
<li><strong>Jakarta Selatan</strong></li>
</ol>
<ul>
<li>Highest public school ratio, dispersed distribution pattern, good accessibility score</li>
</ul>
<ol start="5" type="1">
<li><strong>Jakarta Utara</strong></li>
</ol>
<ul>
<li>Coastal inland disparity, limited special-education access, strong east-west variation</li>
</ul>
</section>
<section id="critical-issues" class="level3">
<h3 class="anchored" data-anchor-id="critical-issues">7.2 Critical Issues</h3>
<ol type="1">
<li><strong>Inequity in Distributional Access</strong></li>
</ol>
<ul>
<li>Special education facilities concentrated in affluent areas (e.g.&nbsp;Jakarta Pusat)</li>
<li>Peripheral regions underserved</li>
<li>Transportation barriers in northern regions</li>
</ul>
<ol start="2" type="1">
<li><strong>Public-Private Balance</strong></li>
</ol>
<ul>
<li>Varying ratio across cities</li>
<li>Competition in central areas</li>
<li>Complementary services in periphery</li>
</ul>
<ol start="3" type="1">
<li><strong>School Level Progression</strong></li>
</ol>
<ul>
<li>Strong elementary-junior high correlation</li>
<li>Weaker junior-senior high alignment sugggests less people make it from junior to senior high possibly due to distribution of schools and accessibility issues</li>
<li>Special education integration challenges</li>
</ul>
</section>
<section id="policy-recommendations" class="level3">
<h3 class="anchored" data-anchor-id="policy-recommendations">7.3 Policy Recommendations</h3>
<p><strong>Short-Term Interventions</strong></p>
<ol type="1">
<li>Access Enhancement</li>
</ol>
<ul>
<li>Expand special education in underserved areas</li>
<li>Improve transportation links to schools</li>
<li>Establish mobile educational services</li>
</ul>
<p><strong>Medium-Term Strategies</strong></p>
<ol type="1">
<li>Infrastructure Development</li>
</ol>
<ul>
<li>New schools in growth areas</li>
<li>Educational complexes in strategic locations</li>
<li>Special education facility expansion</li>
</ul>
<ol start="2" type="1">
<li>Public-Private Collaboration</li>
</ol>
<ul>
<li>Joint planning frameworks</li>
<li>Resource sharing agreements</li>
<li>Standardized access metrics</li>
</ul>
<p><strong>Long-Term Vision</strong></p>
<ol type="1">
<li>Sustainable Distribution</li>
</ol>
<ul>
<li>Comprehensive educational network</li>
<li>Integrated public-private services</li>
<li>Inclusive special education facilities</li>
</ul>
<ol start="2" type="1">
<li>Educational Equity</li>
</ol>
<ul>
<li>Equal access for all students</li>
<li>Progressive school level alignment</li>
<li>Improved transition rates between school levels</li>
</ul>
</section>
</section>
<section id="shiny-application-design" class="level2">
<h2 class="anchored" data-anchor-id="shiny-application-design">8.0 Shiny: Application Design</h2>
<p>You may access the deployed application here: https://baojieyeo.shinyapps.io/THE03_Demo/</p>
<section id="application-directory" class="level3">
<h3 class="anchored" data-anchor-id="application-directory">8.1 Application Directory</h3>
<p>The Shiny component will have the following <code>.R</code> files:</p>
<ul>
<li><code>global.R</code>: Main file that handles data preprocessing logic, KDE and statistical calculations</li>
<li><code>ui.R</code>: User interface design and layout</li>
<li><code>server.R</code>: Server-side logic for data processing and visualization</li>
</ul>
<p>This is the file structure of the app:</p>
<ul>
<li><code>app/</code>
<ul>
<li><code>global.R</code></li>
<li><code>ui.R</code></li>
<li><code>server.R</code></li>
<li><code>data/</code></li>
</ul></li>
</ul>
</section>
<section id="shiny-packages" class="level3">
<h3 class="anchored" data-anchor-id="shiny-packages">8.2 Shiny Packages</h3>
<p>In <code>global.R</code> we define a few shiny packages to be loaded:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(shiny, shinydashboard, shinyWidgets, shinyBS, sf, tidyverse, </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>               viridis, spatstat, spdep, DT, plotly, tmap, tmaptools)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>In particular, we load <code>shinydashboard</code>, <code>shinyWidgets</code>, <code>shinyBS</code>. The <code>shineydashboard</code> package will be used to create a dashboard layout, while <code>shinyWidgets</code> and <code>shinyBS</code> will be used for interactive widgets and bootstrap styling.</p>
</section>
<section id="motivation" class="level3">
<h3 class="anchored" data-anchor-id="motivation">8.3 Motivation</h3>
<p>The application will provide a comprehensive spatial analysis of school distributions across Jakarta through three main analytical perspectives: Provincial Overview, City Analysis, and Statistical Tests.</p>
<p>This tool will enable stakeholders to:</p>
<ul>
<li>Understand educational resource distribution patterns</li>
<li>Identify gaps in educational access across districts</li>
<li>Support evidence-based decision making for new schools placement</li>
<li>Analyze disparities between public and private school distribution</li>
<li>Monitor and evaluate educational access initiatives</li>
</ul>
<p>Proposed target users:</p>
<ul>
<li>Education policymakers</li>
<li>Urban planners</li>
<li>School administrators</li>
<li>Researchers analyzing educational equity</li>
<li>Government officials</li>
</ul>
</section>
<section id="iterative-design" class="level3">
<h3 class="anchored" data-anchor-id="iterative-design">8.4 Iterative Design</h3>
<section id="initial-single-page-design" class="level4">
<h4 class="anchored" data-anchor-id="initial-single-page-design">8.4.1 Initial Single-Page Design</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 101%">
</colgroup>
<tbody>
<tr class="odd">
<td>Jakarta Schools Analysis</td>
</tr>
<tr class="even">
<td><pre><code>       |</code></pre>
<p>Analysis | Spatial Analysis Controls | Visualization | Window | |</p></td>
</tr>
</tbody>
</table>
<p>The initial design was a simple application focused on a two-panel layout that emphasized:</p>
<ul>
<li>Clear visual hierarchy</li>
<li>Efficient space utilization</li>
</ul>
<p>However, there were a few limitations that were immediately apparent. The design was too simplified and we had to cover both provincial and city level analysis. This meant we had to rethink the layout and add more interactive elements, or separate levels through tabs.</p>
</section>
<section id="two-tab-design" class="level4">
<h4 class="anchored" data-anchor-id="two-tab-design">8.4.2 Two-Tab Design</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 100%">
</colgroup>
<tbody>
<tr class="odd">
<td>Jakarta Schools Analysis</td>
</tr>
<tr class="even">
<td>[Province] [City]</td>
</tr>
<tr class="odd">
<td><pre><code>       |</code></pre>
<p>Analysis | Main Visualization Controls | | Statistical| Related Statistical Tests | Visualizations | |</p></td>
</tr>
</tbody>
</table>
<p>With two tabs, we could separate the provincial and city level analysis. This allowed for more detailed visualizations and controls for each level. The statistical tests would be grouped together in their respective tabs.</p>
<p>However, there were still limitations to this design.</p>
<ul>
<li>Statistical tests competed for limited space</li>
<li>Limited ability to focus on specific analyses</li>
<li>Navigation between province and city views seemed confusing</li>
<li>Difficult to compare analyses across different levels</li>
</ul>
</section>
<section id="final-three-tab-design" class="level4">
<h4 class="anchored" data-anchor-id="final-three-tab-design">8.4.3 Final Three-Tab Design</h4>
<table class="caption-top table">
<colgroup>
<col style="width: 70%">
</colgroup>
<tbody>
<tr class="odd">
<td>Spatial Points Patterns Analysis</td>
</tr>
</tbody>
</table>
<p>The three tab design would feature the following tabs:</p>
<ol type="1">
<li>Provincial Overview</li>
<li>City Analysis</li>
<li>Statistical Tests</li>
</ol>
<p>This design solved the issue of space limitations and allowed for more detailed visualizations and controls. The statistical tests would have their own tab, and this seemed more efficient.</p>
<p>If users were interested to know about what goes on behind the scenes, they could navigate to the statistical tests tab. Naturally, the statistics tab were more important to stakeholders rather than regular users.</p>
<p>Each visualization panel contains:</p>
<ul>
<li>Title bar with blue background</li>
<li>Interactive visualizations</li>
<li>Caption and/or descriptions</li>
</ul>
<p>This design meets the following requirements</p>
<ul>
<li>Separation of concerns across tabs</li>
<li>Changes in each tab would not affect the others</li>
<li>Improved visual hierarchy</li>
<li>Equal emphasis on all analysis types</li>
<li>Dedicated control sidebar present in all views (albeit with some minor differences)</li>
</ul>
</section>
</section>
<section id="application-features" class="level3">
<h3 class="anchored" data-anchor-id="application-features">8.5 Application Features</h3>
<section id="provincial-analysis" class="level4">
<h4 class="anchored" data-anchor-id="provincial-analysis">8.4.1 Provincial Analysis</h4>
<p><img src="./screenshots/province_overview.png" class="img-fluid"></p>
<p><strong>Purpose</strong></p>
<p>The Provincial Overview tab provides macro-level insights into school distribution patterns across Jakarta.</p>
<p><strong>Components and Interactions</strong></p>
<p>Left Sidebar Controls:</p>
<p><img src="./screenshots/controls_province.png" class="img-fluid"></p>
<ol type="1">
<li>School Level Filter</li>
<li>School Type Filter</li>
<li>KDE Bandwidth Filter</li>
</ol>
<p>Main Visualizations:</p>
<p><img src="./screenshots/province_plots1.png" class="img-fluid"></p>
<ol type="1">
<li>School Distribution Plot (Top Left)</li>
</ol>
<ul>
<li>Interactive bar chart showing total schools by city</li>
<li>Hoverable for exact counts * Updates based on selected filters</li>
</ul>
<ol start="2" type="1">
<li>School Density Map (Top Right)</li>
</ol>
<ul>
<li>KDE Visualization at the Province Level</li>
<li>Shows spatial clustering of schools</li>
<li>Responds to bandwidth slider</li>
<li>Color intensity indicates school concentration</li>
</ul>
<p><img src="./screenshots/province_plots2.png" class="img-fluid"></p>
<ol start="3" type="1">
<li>Distribution by Level Plot (Bottom Left)</li>
</ol>
<ul>
<li>Stacked bar chart showing school level proportions</li>
<li>Color-coded by school level</li>
<li>Interactive legends</li>
<li>Filtered by selected school types</li>
</ul>
<ol start="4" type="1">
<li>Population Density Map (Bottom Right)</li>
</ol>
<ul>
<li>Background context visualization</li>
<li>Static display (Not affected by filters)</li>
<li>Helps identify mismatch between school and population density</li>
</ul>
</section>
<section id="city-analysis" class="level4">
<h4 class="anchored" data-anchor-id="city-analysis">8.4.2 City Analysis</h4>
<p><img src="./screenshots/city_overview.png" class="img-fluid"></p>
<p><strong>Purpose</strong></p>
<p>Presents a detailed analysis of school distributions within each city.</p>
<p><strong>Components and Interactions</strong></p>
<p><img src="./screenshots/controls_city.png" class="img-fluid"></p>
<p>Left Sidebar Controls:</p>
<ol type="1">
<li>City Selector</li>
</ol>
<ul>
<li>Dropdown to select Jakarta city</li>
<li>Primary filter for this tab</li>
</ul>
<ol start="2" type="1">
<li>School Level Filter</li>
</ol>
<ul>
<li>Same as Provincial tab</li>
<li>Affects city-specific visualizations</li>
</ul>
<ol start="3" type="1">
<li>School Status Filter</li>
</ol>
<ul>
<li>Same as Provincial tab</li>
<li>Updates city-level analyses</li>
</ul>
<p><strong>Main Visualizations</strong></p>
<p><img src="./screenshots/city_plots1.png" class="img-fluid"></p>
<ol type="1">
<li>City KDE Plot (Top Left)</li>
</ol>
<ul>
<li>KDE visualization for selected city</li>
<li>Shows school density distribution</li>
<li>Updates based on selected filters</li>
<li>Includes count in subtitle</li>
</ul>
<ol start="2" type="1">
<li>Public School Ratio (Top Right)</li>
</ol>
<ul>
<li>Bar chart showing public-private ratio</li>
<li>Fixed across cities for comparison</li>
<li>Updates with school type selection</li>
</ul>
<p><img src="./screenshots/city_plots2.png" class="img-fluid"></p>
<ol start="3" type="1">
<li>Nearest Neighbor Analysis (Bottom Left)</li>
</ol>
<ul>
<li>Compares observed vs expected distance</li>
<li>Shows R statistic</li>
<li>Updates with all filters</li>
</ul>
<ol start="4" type="1">
<li>City Statistics Table (Bottom Right)</li>
</ol>
<ul>
<li>Detailed breakdown of schools</li>
<li>Sortable columns</li>
<li>Responsive to all filters</li>
</ul>
</section>
<section id="statistical-tests" class="level4">
<h4 class="anchored" data-anchor-id="statistical-tests">8.4.3 Statistical Tests</h4>
<p><img src="./screenshots/stats_overview.png" class="img-fluid"></p>
<p><strong>Purpose</strong></p>
<p>The statistical tests tab provides advanced spatial statistics for pattern analysis.</p>
<p><strong>Main Visualizations</strong></p>
<p><img src="./screenshots/stats_plots1.png" class="img-fluid"></p>
<ol type="1">
<li>Quadrat Analysis (Top Left)</li>
</ol>
<ul>
<li>Grid-based spatial distribution test</li>
<li>Shows points and quadrat counts</li>
<li>Chi-square results below plot</li>
</ul>
<ol start="2" type="1">
<li>Cross K Function (Top Right)</li>
</ol>
<ul>
<li>Analyzes public-private school interactions</li>
<li>Shows observed vs theoretical patterns</li>
</ul>
<p><img src="./screenshots/stats_plots2.png" class="img-fluid"></p>
<ol start="3" type="1">
<li>K Function Analysis (Bottom Left)</li>
</ol>
<ul>
<li>Overall spatial dependence measure</li>
<li>Shows clustering at different scales</li>
</ul>
<ol start="4" type="1">
<li>L Function Analysis (Bottom Right)</li>
</ol>
<ul>
<li>Normalized version of K Function</li>
<li>Easier interpretation of clustering patterns</li>
</ul>
</section>
</section>
</section>
<section id="shiny-user-interface-design" class="level2">
<h2 class="anchored" data-anchor-id="shiny-user-interface-design">9.0 Shiny: User Interface Design</h2>
<section id="dashboard-framework-and-layout" class="level3">
<h3 class="anchored" data-anchor-id="dashboard-framework-and-layout">9.1 Dashboard Framework and Layout</h3>
<p>The user interface utilizes <code>shinydashboard</code> to create an application with a clear visual hierarchy. The three-tabbed design is implemented through a persistent sidebar menu that maintains context across different views.</p>
<section id="layout-components" class="level4">
<h4 class="anchored" data-anchor-id="layout-components">9.1.1. Layout Components</h4>
<ul>
<li>Headers: Dual-line title with hierarchical typography</li>
<li>Sidebar: Fixed width (300px) navigation and control panel</li>
<li>Body: Responsive grid-based content area</li>
<li>Boxes: Consistent 6-column width containers for visualizations</li>
</ul>
</section>
</section>
<section id="color-palette" class="level3">
<h3 class="anchored" data-anchor-id="color-palette">9.2 Color Palette</h3>
<p><strong>Primary Colors</strong>:</p>
<ul>
<li>Brand Blue: #3c8dbc (Links, buttons, active states)</li>
<li>Dark Background: #2c3b41 (Sidebar)</li>
<li>White: #ffffff (Text, icons)</li>
<li>Muted: #4f5962 (Borders, separators)</li>
</ul>
<p><strong>Accent Colors</strong>: - Success/Active: #367fa9 - Border Highlight: rgba(255, 255, 255, 0.2)</p>
<p>These colors were chosen to maintain a professional, modern look while ensuring readability and accessibility.</p>
</section>
<section id="interactivity" class="level3">
<h3 class="anchored" data-anchor-id="interactivity">9.3. Interactivity</h3>
</section>
<section id="shinywidgets-components" class="level3">
<h3 class="anchored" data-anchor-id="shinywidgets-components">9.3.1 <code>shinyWidgets</code> components</h3>
<p><strong>Pretty Checkbox Groups</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="fu">prettyCheckboxGroup</span>(</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">inputId =</span> <span class="st">"schoolLevels"</span>,</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">"School Levels:"</span>,</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">choices =</span> <span class="fu">c</span>(<span class="st">"Elementary"</span>, <span class="st">"Junior High"</span>, <span class="st">"Senior High"</span>, <span class="st">"Special Education"</span>),</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">animation =</span> <span class="st">"smooth"</span>,</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">icon =</span> <span class="fu">icon</span>(<span class="st">"check"</span>)</span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The checkboxes are styled wih the <code>shinyWidgets</code> package to provide enhanced visual feedback, clear active states and improved touch targets.</p>
<p><strong>Picker Inputs</strong></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pickerInput</span>(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">inputId =</span> <span class="st">"citySelect"</span>,</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">label =</span> <span class="st">"Select City:"</span>,</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">choices =</span> cities,</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">style =</span> <span class="st">"btn-primary"</span>,</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">5</span>,</span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">live-search</span><span class="st">`</span> <span class="ot">=</span> <span class="cn">TRUE</span></span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>pickerInput</code> widget is used to create a dropdown with search functionality. This allows users to quickly find and select the desired city.</p>
</section>
<section id="shinybs-tooltips" class="level3">
<h3 class="anchored" data-anchor-id="shinybs-tooltips">9.3.2 <code>shinyBS</code> tooltips</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">bsTooltip</span>(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">"provincialBandwidth"</span>,</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Adjust the smoothing parameter for density estimation"</span>,</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">placement =</span> <span class="st">"right"</span>,</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">options =</span> <span class="fu">list</span>(<span class="at">container =</span> <span class="st">"body"</span>)</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When adjusting the KDE bandwidth slider, we provide a tooltip to explain the purpose of this control. This improves accessibility while maintaining clear instruction delivery. The positioning of the tooltip is also non-intrusive to the main content.</p>
</section>
<section id="visual-container-system" class="level3">
<h3 class="anchored" data-anchor-id="visual-container-system">9.4 Visual Container System</h3>
<section id="box-components" class="level4">
<h4 class="anchored" data-anchor-id="box-components">9.4.1 Box Components</h4>
<p>Each visualization is contained within a standardized box.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">box</span>(<span class="at">width =</span> <span class="dv">6</span>,</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">plotOutput</span>(<span class="st">"visualization"</span>),</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Main Title"</span>,</span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">subtitle =</span> <span class="st">"Descriptive subtitle"</span>,</span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">status =</span> <span class="st">"primary"</span>,</span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">solidHeader =</span> <span class="cn">TRUE</span>,</span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">footer =</span> <span class="fu">div</span>(</span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">class =</span> <span class="st">"text-muted"</span>,</span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>      <span class="at">style =</span> <span class="st">"font-style: italic; padding: 10px;"</span>,</span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>      <span class="st">"Contextual information"</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The box component includes:</p>
<ul>
<li>Consistent padding</li>
<li>Clear visual hierarchy</li>
<li>Contextual footers</li>
<li>Solid headers for emphasis</li>
</ul>
</section>
<section id="sidebar-sections" class="level4">
<h4 class="anchored" data-anchor-id="sidebar-sections">9.4.2 Sidebar Sections</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>.sidebar<span class="sc">-</span>section {</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  padding<span class="sc">:</span> <span class="dv">10</span>px;</span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  margin<span class="sc">:</span> <span class="dv">10</span>px <span class="dv">0</span>;</span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  background<span class="sc">:</span> <span class="fu">rgba</span>(<span class="dv">255</span>, <span class="dv">255</span>, <span class="dv">255</span>, <span class="fl">0.05</span>);</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  border<span class="sc">-</span>radius<span class="sc">:</span> <span class="dv">4</span>px;</span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The sidebar controls are different depending on which tab the user is on. The sidebar section is deliberately styled according to the above to provide a clear visual separation from the main content area.</p>
</section>
</section>
</section>
<section id="shiny-storyboarding" class="level2">
<h2 class="anchored" data-anchor-id="shiny-storyboarding">10.0 Shiny: Storyboarding</h2>
<section id="user-personas" class="level3">
<h3 class="anchored" data-anchor-id="user-personas">10.1 User Personas</h3>
<p><strong>Education Policymaker</strong></p>
<ul>
<li>User Background: Maria, Director of Education Planning</li>
<li>Needs: Understand resource distribution, identify underserved areas</li>
<li>Goals: Make data-driven decisions about new school locations</li>
</ul>
<p><strong>Urban Planner</strong></p>
<ul>
<li>User Background: Ahmad, City Development Analyst</li>
<li>Needs: Analyze school accessibility relative to population density</li>
<li>Goals: Integrate education facilities into urban development plans</li>
</ul>
<p><strong>School Administrator</strong></p>
<ul>
<li>User Background: James, Private School Network Manager</li>
<li>Needs: Understand market gaps and opportunities</li>
<li>Goals: Strategic planning for new educational facilities</li>
</ul>
</section>
<section id="user-journey-map" class="level3">
<h3 class="anchored" data-anchor-id="user-journey-map">10.2 User Journey Map</h3>
<section id="initial-engagement" class="level4">
<h4 class="anchored" data-anchor-id="initial-engagement">10.2.1 Initial Engagement</h4>
<ol type="1">
<li>Entry Point: Provincial Overview Tab</li>
<li>First Impressions: School Distribution Chart</li>
<li>Progression: KDE Map Exploration</li>
<li>Context Building: Population Density Comparison</li>
</ol>
</section>
<section id="learning-flow" class="level4">
<h4 class="anchored" data-anchor-id="learning-flow">10.2.2 Learning Flow</h4>
<p><strong>Provincial Level Understanding</strong></p>
<p>Step 1: Overall Distribution - Views total school counts across cities - Notices East Jakarta has highest concentration - Questions: “Why this distribution?”</p>
<p>Step 2: Density Patterns - Explores KDE map - Adjusts bandwidth to see clustering - Insight: Schools cluster in urban centers</p>
<p>Step 3: Educational Level Analysis - Switches to level distribution - Compares proportions across cities - Discovery: Elementary schools dominate</p>
<p><strong>City Level Deep Dive</strong></p>
<p>Step 1: City Selection - Chooses area of interest - Focuses on local patterns - Compares with provincial context</p>
<p>Step 2: Public-Private Balance - Examines ownership ratios - Notes variations by district - Identifies service gaps</p>
<p>Step 3: Spatial Analysis - Studies nearest neighbor results - Understands clustering patterns - Forms hypotheses about distribution</p>
<p><strong>Statistical Validation</strong></p>
<p>Step 1: Pattern Confirmation - Reviews quadrat analysis - Validates clustering observations - Builds confidence in findings</p>
<p>Step 2: Cross-Analysis - Examines K-functions - Understands spatial relationships - Confirms or adjusts hypotheses</p>
</section>
</section>
<section id="key-learning-moments" class="level3">
<h3 class="anchored" data-anchor-id="key-learning-moments">10.3 Key Learning Moments</h3>
<section id="distribution-insights" class="level4">
<h4 class="anchored" data-anchor-id="distribution-insights">10.3.1 Distribution Insights</h4>
<p><strong>User Thought Process</strong></p>
<ul>
<li>“I see East Jakarta has the most schools, but…” -&gt;</li>
<li>“The density map shows concentrations in unexpected areas” -&gt;</li>
<li>“Population density explains some patterns, but not all” -&gt;</li>
<li>“There might be historical or socioeconomic factors at play”</li>
</ul>
</section>
<section id="accessibility-analysis" class="level4">
<h4 class="anchored" data-anchor-id="accessibility-analysis">10.3.2 Accessibility Analysis</h4>
<p><strong>User Realization Path</strong></p>
<ul>
<li>“High school distribution seems more clustered than elementary” -&gt;</li>
<li>“This makes sense given transportation capabilities of older students” -&gt;</li>
<li>“But some areas might still be underserved” -&gt;</li>
<li>“Need to compare with population age demographics”</li>
</ul>
</section>
<section id="policy-implications" class="level4">
<h4 class="anchored" data-anchor-id="policy-implications">10.3.3 Policy Implications</h4>
<p><strong>Decision-Making Process</strong></p>
<ul>
<li>“Statistical tests confirm non-random distribution” -&gt;</li>
<li>“Some areas show significant clustering” -&gt;</li>
<li>“Need to balance between concentration and accessibility” -&gt;</li>
<li>“Can identify priority areas for new facilities”</li>
</ul>
</section>
</section>
<section id="knowledge-building" class="level3">
<h3 class="anchored" data-anchor-id="knowledge-building">10.4 Knowledge Building</h3>
<section id="core-insights" class="level4">
<h4 class="anchored" data-anchor-id="core-insights">10.4.1 Core Insights</h4>
<ol type="1">
<li><strong>Spatial Distribution Understanding</strong></li>
</ol>
<ul>
<li>Pattern recognition</li>
<li>Clustering identification</li>
<li>Access gap discovery</li>
</ul>
<ol start="2" type="1">
<li><strong>Educational Resource Balance</strong></li>
</ol>
<ul>
<li>Public-private dynamics</li>
<li>Level distribution patterns</li>
<li>Service coverage analysis</li>
</ul>
<ol start="3" type="1">
<li><strong>Statistical Validation</strong></li>
</ol>
<ul>
<li>Pattern confirmation</li>
<li>Significance understanding</li>
<li>Evidence-based conclusions</li>
</ul>
</section>
<section id="applied-learning" class="level4">
<h4 class="anchored" data-anchor-id="applied-learning">10.4.2 Applied Learning</h4>
<p>Observation → Analysis → Validation → Action Example: Notices clustering → Examines local factors → Confirms statistical significance → Identifies development opportunities</p>
<p>This proposed storyboard emphasizes user discovery and learning, guiding stakeholders through meaningful analysis while maintaining flexibility for different analytical approaches. Each interaction builds upon previous knowledge, creating a comprehensive understanding of Jakarta’s educational landscape.</p>
</section>
</section>
</section>
<section id="references" class="level2">
<h2 class="anchored" data-anchor-id="references">References</h2>
<ol type="1">
<li>Claude AI. (n.d.). Claude AI. https://claude.ai/</li>
<li>Kraak, M. J. (2020). <em>Advanced Applications of Spatial Analysis Dashboards.</em> International Journal of Geographical Information Science.</li>
<li>Seah, G. (2021). “Building a Storyboard for Analytics Dashboard”. https://giniceseah.netlify.app/posts/2021-07-31-storyboard/</li>
<li>Shneiderman, B., et al.&nbsp;(2016). <em>Designing the User Interface: Strategies for Effective Human-Computer Interaction (6th ed.)</em>. Pearson.</li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>